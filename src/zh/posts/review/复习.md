---
icon: pen-to-square
date: 2025-07-13
category:
  - Learning Records
tag:
  - Review
---

# å¤ä¹ 

## é¡¹ç›® - åˆ†å¸ƒå¼è°ƒåº¦å¼•æ“

### 1. æ¶æ„è®¾è®¡ç›¸å…³é—®é¢˜

**Q1: é¡¹ç›®ä¸­ç¢°åˆ°äº†å“ªäº›å›°éš¾ï¼Ÿæ¶æ„å±‚é¢å’Œå¼€å‘å±‚é¢ï¼Ÿ**
#### æ¶æ„å±‚é¢

1. é«˜å¯ç”¨æ¶æ„è®¾è®¡å›°éš¾
- é—®é¢˜ï¼šå¦‚ä½•ä¿è¯ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§
- æŒ‘æˆ˜ï¼šéœ€è¦è®¾è®¡æ— å•ç‚¹æ•…éšœçš„æ¶æ„
- è§£å†³æ–¹æ¡ˆï¼š
  * åº”ç”¨å±‚ï¼šSpring Booté›†ç¾¤éƒ¨ç½²ï¼ˆ3ä¸ªå®ä¾‹ï¼‰ï¼ŒNginxè½®è¯¢åˆ†å‘è¯·æ±‚åˆ°åº”ç”¨å±‚
  * è°ƒåº¦å™¨ï¼šXXL-JOBè°ƒåº¦ä¸­å¿ƒï¼ˆ1ä¸ª+çƒ­å¤‡ï¼‰ï¼ŒXXL-JOBæ‰§è¡Œå™¨ï¼ˆ3ä¸ªï¼‰
  * æ•°æ®åº“å±‚ï¼šMySQLä¸»ä»å¤åˆ¶ï¼ˆ1ä¸»2ä»ï¼‰ï¼ŒProxySQLè¯»å†™åˆ†ç¦»ï¼ˆ1ä¸ªï¼Œå¾…ä¼˜åŒ–ï¼‰
  * ç¼“å­˜å±‚ï¼šRediså“¨å…µæ¨¡å¼ï¼ˆ3å“¨å…µ+1ä¸»2ä»ï¼‰ï¼ŒRedisç¼“å­˜çƒ­ç‚¹æ•°æ®
  * ç›‘æ§ï¼šé›†æˆSpring Boot Actuatorï¼ˆç›‘æ§ CPUã€JVMã€MySQLã€RedisçŠ¶æ€ï¼‰

2. åˆ†å¸ƒå¼ä¸€è‡´æ€§éš¾é¢˜
- é—®é¢˜ï¼šå¤šèŠ‚ç‚¹ç¯å¢ƒä¸‹å¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§
- æŒ‘æˆ˜ï¼šä»»åŠ¡çŠ¶æ€åŒæ­¥ã€åˆ†å¸ƒå¼é”å®ç°
- è§£å†³æ–¹æ¡ˆï¼š

æˆ‘ä»¬é‡‡ç”¨"XXL-JOB + åˆ†å¸ƒå¼é” + è¡¥å¿æœºåˆ¶"çš„ç»„åˆæ–¹æ¡ˆæ¥è§£å†³åˆ†å¸ƒå¼ä¸€è‡´æ€§é—®é¢˜ã€‚XXL-JOBè´Ÿè´£ä»»åŠ¡è°ƒåº¦å’Œå»é‡ï¼Œåˆ†å¸ƒå¼é”ä¿è¯å¹¶å‘å®‰å…¨ï¼Œè¡¥å¿æœºåˆ¶å¤„ç†è·¨æœåŠ¡æ•°æ®ä¸ä¸€è‡´ã€‚ä¸‰è€…å„å¸å…¶èŒã€äº’è¡¥æ€§å¼ºï¼Œå®ç°äº†å®Œæ•´çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§ä¿è¯ã€‚

#### ä»»åŠ¡è°ƒåº¦å±‚é¢ï¼ˆXXL-JOBï¼‰
**XXL-JOBçš„æ¶æ„è®¾è®¡å’ŒèŒè´£åˆ’åˆ†**
- A. é¡¹ç›®ç³»ç»Ÿè´Ÿè´£ï¼š
  * è„šæœ¬ç®¡ç† - ä¸Šä¼ ã€å­˜å‚¨ã€ç¼–è¾‘è„šæœ¬æ–‡ä»¶
  * ä»»åŠ¡ç®¡ç† - åˆ›å»ºã€é…ç½®ã€ç®¡ç†å®šæ—¶ä»»åŠ¡
  * ç”¨æˆ·ç®¡ç† - æƒé™æ§åˆ¶ã€ç”¨æˆ·è®¤è¯
  * ç›‘æ§ç•Œé¢ - æ‰§è¡ŒçŠ¶æ€ã€æ—¥å¿—æŸ¥çœ‹ã€ç»Ÿè®¡åˆ†æ
- B. XXL-JOBè´Ÿè´£ï¼š
  * å®šæ—¶è°ƒåº¦ - æŒ‰Cronè¡¨è¾¾å¼è§¦å‘ä»»åŠ¡æ‰§è¡Œ
  * åˆ†å¸ƒå¼æ‰§è¡Œ - å¤šå®ä¾‹è´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»
  * æ‰§è¡Œç›‘æ§ - ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€è·Ÿè¸ª
  * æ—¥å¿—è®°å½• - è¯¦ç»†çš„æ‰§è¡Œæ—¥å¿—å’Œé”™è¯¯ä¿¡æ¯
- XXL-JOBè°ƒåº¦ä¸­å¿ƒçš„çƒ­å¤‡ä¸æ˜¯è‡ªåŠ¨é›†ç¾¤ï¼Œè€Œæ˜¯ä¸»å¤‡æ¨¡å¼ï¼š
  * ä¸»è°ƒåº¦ä¸­å¿ƒï¼šæ­£å¸¸å·¥ä½œï¼Œå¤„ç†æ‰€æœ‰è°ƒåº¦
  * å¤‡è°ƒåº¦ä¸­å¿ƒï¼šå¾…å‘½çŠ¶æ€ï¼Œå…±äº«åŒä¸€æ•°æ®åº“
  * æ‰‹åŠ¨/åŠè‡ªåŠ¨åˆ‡æ¢ï¼šä¸»æŒ‚äº†ï¼Œäººå·¥æˆ–è„šæœ¬å¯ç”¨å¤‡ç”¨

**XXL-JOBè°ƒåº¦ä¸­å¿ƒå·²è§£å†³çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§é—®é¢˜**
- ä»»åŠ¡é‡å¤æ‰§è¡Œé˜²æŠ¤
  - é€šè¿‡æ•°æ®åº“å”¯ä¸€çº¦æŸé˜²æ­¢åŒä¸€ä»»åŠ¡è¢«é‡å¤è°ƒåº¦
  - æ‰§è¡Œå™¨é€šè¿‡ä»»åŠ¡IDå»é‡ï¼Œé¿å…é‡å¤æ‰§è¡Œ
- ä»»åŠ¡çŠ¶æ€ä¸€è‡´æ€§
  - è°ƒåº¦ä¸­å¿ƒç»Ÿä¸€ç®¡ç†ä»»åŠ¡çŠ¶æ€ï¼ˆå¾…æ‰§è¡Œã€æ‰§è¡Œä¸­ã€æ‰§è¡Œå®Œæˆã€æ‰§è¡Œå¤±è´¥ï¼‰
  - æ‰§è¡Œå™¨å®šæœŸå¿ƒè·³ä¸ŠæŠ¥ï¼Œä¿æŒçŠ¶æ€åŒæ­¥
- åˆ†å¸ƒå¼é”æœºåˆ¶
  - è°ƒåº¦ä¸­å¿ƒé€šè¿‡æ•°æ®åº“è¡Œé”ä¿è¯ä»»åŠ¡åˆ†é…çš„åŸå­æ€§
  - é¿å…å¤šä¸ªè°ƒåº¦ä¸­å¿ƒåŒæ—¶åˆ†é…åŒä¸€ä»»åŠ¡
- ä»»åŠ¡æ‰§è¡Œç»“æœä¸€è‡´æ€§
  - æ‰§è¡Œå™¨æ‰§è¡Œå®Œæˆåç»Ÿä¸€å›è°ƒè°ƒåº¦ä¸­å¿ƒ
  - è°ƒåº¦ä¸­å¿ƒè®°å½•æ‰§è¡Œç»“æœï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§ 

**é¡¹ç›®è§£å†³çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§é—®é¢˜**
XXL-JOBè™½ç„¶èƒ½è§£å†³ä»»åŠ¡é‡å¤æ‰§è¡Œçš„é—®é¢˜ï¼Œä½†åœ¨æˆ‘ä»¬çš„åˆ†å¸ƒå¼è°ƒåº¦å¼•æ“ä¸­ï¼Œè¿˜æœ‰å¾ˆå¤šè·¨æœåŠ¡çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜å®ƒæ— æ³•è§£å†³ï¼š

1. è„šæœ¬æ–‡ä»¶ä¸ä»»åŠ¡é…ç½®çš„ä¸€è‡´æ€§
2. ä»»åŠ¡çŠ¶æ€ä¸XXL-JOBæ‰§è¡ŒçŠ¶æ€çš„ä¸€è‡´æ€§  
3. ç”¨æˆ·æƒé™å˜æ›´ä¸ä»»åŠ¡æ‰§è¡Œçš„ä¸€è‡´æ€§
4. ç³»ç»Ÿé…ç½®ä¸ä»»åŠ¡è¡Œä¸ºçš„ä¸€è‡´æ€§

æ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨äº†"**XXL-JOB + åˆ†å¸ƒå¼é” + è¡¥å¿æœºåˆ¶**"çš„ç»„åˆæ–¹æ¡ˆï¼šXXL-JOBè´Ÿè´£ä»»åŠ¡è°ƒåº¦å’Œå»é‡ï¼Œåˆ†å¸ƒå¼é”ä¿è¯å¹¶å‘å®‰å…¨ï¼Œè¡¥å¿æœºåˆ¶å¤„ç†è·¨æœåŠ¡æ•°æ®ä¸ä¸€è‡´ï¼Œè¿™æ ·å°±èƒ½å®ç°å®Œæ•´çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§ä¿è¯ã€‚

**sagaï¼šæœ¬åœ°ä¸€è‡´+è¡¥å¿æœºåˆ¶**
è¡¥å¿æœºåˆ¶é€šè¿‡**æ¶ˆæ¯é˜Ÿåˆ—**å®ç°ï¼Œä¸»è¦å¤„ç†éƒ¨åˆ†æˆæœã€è·¨æœåŠ¡æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚

ä¾‹å­ï¼šè¡¥å¿æœºåˆ¶çš„å…·ä½“å¤„ç†æµç¨‹æ˜¯ï¼š

1. è„šæœ¬ä¸Šä¼ æˆåŠŸ âœ…
2. ä»»åŠ¡é…ç½®åˆ›å»ºæˆåŠŸ âœ…  
3. XXL-JOBæ³¨å†Œå¤±è´¥ âŒ

è¡¥å¿æœºåˆ¶ä¼šä»æœ€åä¸€æ­¥å¼€å§‹ï¼Œå€’åºæ¸…ç†å·²æˆåŠŸçš„æ“ä½œã€‚

ç¬¬ä¸€æ­¥ï¼šç³»ç»Ÿæ£€æµ‹åˆ°XXL-JOBæ³¨å†Œå¤±è´¥ï¼Œç«‹å³å‘é€è¡¥å¿æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—
- æ¶ˆæ¯ç±»å‹ï¼šTASK_CREATION_FAILED
- åŒ…å«æ•°æ®ï¼šè„šæœ¬è·¯å¾„ã€ä»»åŠ¡IDã€å¤±è´¥åŸå› ç­‰

ç¬¬äºŒæ­¥ï¼šè¡¥å¿å¤„ç†å™¨æ¶ˆè´¹æ¶ˆæ¯ï¼Œæ‰§è¡Œå€’åºæ¸…ç†
- æ¸…ç†XXL-JOBç›¸å…³æ•°æ®ï¼ˆå¦‚æœæœ‰éƒ¨åˆ†æ³¨å†ŒæˆåŠŸï¼‰
- åˆ é™¤å·²åˆ›å»ºçš„ä»»åŠ¡é…ç½®
- æ¸…ç†å·²ä¸Šä¼ çš„è„šæœ¬æ–‡ä»¶

ç¬¬ä¸‰æ­¥ï¼šæ›´æ–°ä»»åŠ¡çŠ¶æ€ä¸º"åˆ›å»ºå¤±è´¥"ï¼Œè®°å½•è¡¥å¿æ—¥å¿—

é‡‡ç”¨äº†Saga"æœ¬åœ°äº‹åŠ¡+è¡¥å¿æœºåˆ¶"çš„ç»„åˆæ–¹æ¡ˆï¼š

1. **æœ¬åœ°äº‹åŠ¡**ï¼šä¿è¯æ¯ä¸ªæœåŠ¡å†…éƒ¨çš„æ•°æ®ä¸€è‡´æ€§
  - è„šæœ¬æœåŠ¡ï¼šæ–‡ä»¶ä¸Šä¼ çš„åŸå­æ€§
  - ä»»åŠ¡æœåŠ¡ï¼šä»»åŠ¡é…ç½®çš„åŸå­æ€§
  - XXL-JOBæœåŠ¡ï¼šä»»åŠ¡æ³¨å†Œçš„åŸå­æ€§

2. **è¡¥å¿æœºåˆ¶**ï¼šå¤„ç†è·¨æœåŠ¡çš„ä¸ä¸€è‡´é—®é¢˜
  - å½“æŸä¸ªæœåŠ¡å¤±è´¥æ—¶ï¼Œè‡ªåŠ¨æ¸…ç†å…¶ä»–æœåŠ¡å·²æˆåŠŸçš„æ“ä½œ
  - é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥å¤„ç†ï¼Œä¸å½±å“ä¸»æµç¨‹æ€§èƒ½
  - å®ç°æœ€ç»ˆä¸€è‡´æ€§ï¼Œè€Œä¸æ˜¯å¼ºä¸€è‡´æ€§

è¿™æ ·æ—¢ä¿æŒäº†å¾®æœåŠ¡çš„ç‹¬ç«‹æ€§ï¼Œåˆè§£å†³äº†è·¨æœåŠ¡çš„ä¸€è‡´æ€§é—®é¢˜ã€‚

**åˆ†å¸ƒå¼é”**
ä¿è¯é«˜å¹¶å‘åœºæ™¯ä¸‹çš„å®‰å…¨ï¼Œé”ç²’åº¦æ˜¯ï¼š
- ç”¨æˆ·çº§åˆ«ï¼šæŒ‰ç”¨æˆ·IDåŠ é”ï¼Œä¸åŒç”¨æˆ·å¯ä»¥å¹¶å‘æ“ä½œ
- èµ„æºçº§åˆ«ï¼šæŒ‰èµ„æºIDåŠ é”ï¼Œä¸åŒèµ„æºå¯ä»¥å¹¶å‘æ“ä½œ
- æ—¶é—´çº§åˆ«ï¼šè®¾ç½®åˆç†çš„é”è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢æ­»é”

æˆ‘ä»¬é€‰æ‹©Redissonå®ç°åˆ†å¸ƒå¼é”ï¼Œä¸»è¦è€ƒè™‘å®ƒçš„ä¸“ä¸šæ€§å’Œå¯é æ€§ï¼š

1. è‡ªåŠ¨ç»­æœŸæœºåˆ¶ï¼šRedissonæ”¯æŒé”çš„è‡ªåŠ¨ç»­æœŸï¼Œé¿å…ä¸šåŠ¡æ‰§è¡Œæ—¶é—´è¿‡é•¿å¯¼è‡´é”è¿‡æœŸ
2. å¯é‡å…¥é”æ”¯æŒï¼šåŒä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤šæ¬¡è·å–åŒä¸€ä¸ªé”ï¼Œé¿å…æ­»é”
3. å…¬å¹³é”å®ç°ï¼šæ”¯æŒå…¬å¹³é”ï¼Œä¿è¯é”çš„è·å–é¡ºåº
4. çœ‹é—¨ç‹—æœºåˆ¶ï¼šè‡ªåŠ¨ç›‘æ§é”çš„çŠ¶æ€ï¼Œå¼‚å¸¸æƒ…å†µä¸‹è‡ªåŠ¨é‡Šæ”¾é”

è¿™æ ·æ—¢ä¿è¯äº†å¹¶å‘å®‰å…¨ï¼Œåˆä¸ä¼šè¿‡åº¦å½±å“ç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½ã€‚


#### æ•°æ®åº“å±‚é¢ï¼ˆProxySQLï¼‰
* æ•°æ®åº“ä¸»ä»åˆ‡æ¢æ—¶çš„æ•°æ®åŒæ­¥
    - ä¸»ä»å¤åˆ¶é€šè¿‡binlogæœºåˆ¶ï¼ˆå†™å…¥ä¸­ç»§æ—¥å¿—ï¼Œç„¶åä»åº“é‡æ”¾ï¼‰å®ç°æ•°æ®åŒæ­¥ï¼ŒProxySQLåœ¨æ­¤åŸºç¡€ä¸Šæä¾›è¯»å†™åˆ†ç¦»å’Œæ•…éšœåˆ‡æ¢ã€‚
* æ•°æ®åº“è¯»å†™åˆ†ç¦»
    - ä½¿ç”¨ProxySQLå®ç°è¯»å†™åˆ†ç¦»ï¼Œæ ¹æ®è¯·æ±‚ç±»å‹ï¼ˆè¯»/å†™ï¼‰è‡ªåŠ¨è·¯ç”±åˆ°ä¸»åº“æˆ–ä»åº“
    - ç¬¬ä¸€æ­¥ï¼Œå®šä¹‰æœåŠ¡å™¨ç»„ã€‚ æˆ‘ä»¬åˆ›å»ºäº†è¯»å†™åˆ†ç¦»ç»„ï¼Œå†™ç»„IDæ˜¯10ï¼Œè¯»ç»„IDæ˜¯20ï¼Œè¿™æ ·ProxySQLå°±çŸ¥é“å“ªäº›æ˜¯ä¸»åº“å“ªäº›æ˜¯ä»åº“ã€‚
    - ç¬¬äºŒæ­¥ï¼Œé…ç½®æœåŠ¡å™¨ã€‚ æŠŠä¸»åº“IPåŠ å…¥å†™ç»„10ï¼Œä»åº“IPåŠ å…¥è¯»ç»„20ï¼Œæ¯ä¸ªæœåŠ¡å™¨éƒ½è¦è®¾ç½®çŠ¶æ€ä¸ºONLINEã€‚
    - ç¬¬ä¸‰æ­¥ï¼Œé…ç½®è·¯ç”±è§„åˆ™ã€‚ å†™æ“ä½œï¼ˆINSERT/UPDATE/DELETEï¼‰è‡ªåŠ¨è·¯ç”±åˆ°å†™ç»„ï¼Œè¯»æ“ä½œï¼ˆSELECTï¼‰è‡ªåŠ¨è·¯ç”±åˆ°è¯»ç»„ã€‚
* æ•°æ®åº“ä¸»åº“å®•æœºåï¼Œå¦‚ä½•è‡ªåŠ¨åˆ‡æ¢ï¼ˆProxySQLï¼‰
    - è‡ªåŠ¨æ£€æµ‹ - æ¯200ms pingä¸€æ¬¡ä¸»åº“ï¼Œæ£€æµ‹è¿æ¥çŠ¶æ€
    - æ•…éšœåˆ¤æ–­ - è¿ç»­å¤±è´¥è¾¾åˆ°é˜ˆå€¼ï¼ˆå¦‚3æ¬¡ï¼‰åï¼Œè‡ªåŠ¨æ ‡è®°ä¸»åº“ä¸ºOFFLINE
    - æ™ºèƒ½è·¯ç”± - å†™è¯·æ±‚è‡ªåŠ¨è·¯ç”±åˆ°æ–°çš„ä¸»åº“ï¼Œè¯»è¯·æ±‚åˆ†æ•£åˆ°æ‰€æœ‰å¯ç”¨ä»åº“
    - é€æ˜åˆ‡æ¢ - åº”ç”¨å±‚æ— éœ€æ„ŸçŸ¥ï¼Œè¿æ¥ProxySQLå³å¯ï¼Œåº•å±‚åˆ‡æ¢å®Œå…¨é€æ˜
* æ•°æ®åº“ä¸»åº“å®•æœºæ¢å¤å
    - ProxySQLæŒç»­pingå®•æœºçš„ä¸»åº“
    - ä¸»åº“æ¢å¤åï¼ŒpingæˆåŠŸ
    - è¿ç»­æˆåŠŸè¾¾åˆ°é˜ˆå€¼åï¼Œæ ‡è®°ä¸»åº“ä¸ºONLINE
    - å†™æ“ä½œï¼šè‡ªåŠ¨è·¯ç”±å›ä¸»åº“ï¼ˆå› ä¸ºä¸»åº“åœ¨å†™ç»„ä¸”çŠ¶æ€ä¸ºONLINEï¼‰
    - è¯»æ“ä½œï¼šç»§ç»­åˆ†æ•£åˆ°æ‰€æœ‰å¯ç”¨èŠ‚ç‚¹ï¼ˆåŒ…æ‹¬æ¢å¤çš„ä¸»åº“ï¼‰
    - æ•°æ®ä¸€è‡´æ€§ï¼šç¡®ä¿ä¸»åº“æ•°æ®ä¸ä»åº“åŒæ­¥åå†æ¢å¤å†™è·¯ç”±ï¼ŒåŒæ­¥æ–¹æ³•æ˜¯é€šè¿‡MySQLä¸»ä»å¤åˆ¶æœºåˆ¶ï¼ŒProxySQLç›‘æ§å¤åˆ¶å»¶è¿Ÿï¼Œåªæœ‰å½“ä»åº“å»¶è¿Ÿå°äºè®¾å®šé˜ˆå€¼æ—¶æ‰æ¢å¤ä¸»åº“å†™æ“ä½œã€‚
* å¤‡ç”¨é™çº§æ–¹æ¡ˆ
    - å¦‚æœProxySQLå®•æœºï¼Œä¼šé›†ç¾¤éƒ¨ç½²ProxySQLæˆ–ä½¿ç”¨AOPæ¥åˆ‡æ¢åˆ°å¤‡ç”¨æ•°æ®åº“ï¼Œä¿è¯æœåŠ¡ä¸ä¸­æ–­ï¼ˆå¾…ä¼˜åŒ–ï¼Œç°åœ¨æ˜¯å•å°ProxySQLï¼‰


**æ¶æ„å›¾ï¼š**
```
åº”ç”¨1 â”€â”€â”
         â”œâ”€â”€â†’ ProxySQL â”€â”€â†’ ä¸»åº“MySQL
åº”ç”¨2 â”€â”€â”˜              â””â”€â”€â†’ ä»åº“MySQL
```

**å…·ä½“è¿æ¥æ–¹å¼ï¼š**

**1. åº”ç”¨å±‚é…ç½®ï¼š**
```yaml
# application.yml
spring:
  datasource:
    url: jdbc:mysql://ProxySQL_IP:6033/æ•°æ®åº“å
    username: ç”¨æˆ·å
    password: å¯†ç 
```

**2. ProxySQLé…ç½®ï¼š**
```sql
-- é…ç½®åç«¯MySQLæœåŠ¡å™¨
INSERT INTO mysql_servers VALUES (1, '192.168.1.10', 3306, 10, 'ONLINE', 1, 0, 2000, 2000, 0); -- ä¸»åº“
INSERT INTO mysql_servers VALUES (2, '192.168.1.11', 3306, 20, 'ONLINE', 1, 0, 2000, 2000, 0); -- ä»åº“
```

**3. å·¥ä½œæµç¨‹ï¼š**
- **åº”ç”¨1å’Œåº”ç”¨2**ï¼šéƒ½è¿æ¥ProxySQLçš„6033ç«¯å£
- **ProxySQL**ï¼šæ ¹æ®SQLç±»å‹è‡ªåŠ¨è·¯ç”±åˆ°ä¸»åº“æˆ–ä»åº“
- **åº”ç”¨æ„ŸçŸ¥ä¸åˆ°**ï¼šåº•å±‚æ˜¯ä¸»åº“è¿˜æ˜¯ä»åº“å¯¹åº”ç”¨å®Œå…¨é€æ˜

**ä¼˜åŠ¿ï¼š**
- **ç»Ÿä¸€å…¥å£**ï¼šæ‰€æœ‰åº”ç”¨éƒ½è¿æ¥ProxySQL
- **è‡ªåŠ¨è·¯ç”±**ï¼šå†™æ“ä½œè‡ªåŠ¨èµ°ä¸»åº“ï¼Œè¯»æ“ä½œè‡ªåŠ¨èµ°ä»åº“
- **æ•…éšœåˆ‡æ¢**ï¼šä¸»åº“å®•æœºæ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°ä»åº“

#### Rediså±‚é¢ï¼ˆRediså“¨å…µï¼‰
* Redisç¼“å­˜äº†ä»€ä¹ˆä¸šåŠ¡æ•°æ®ï¼Ÿ
    - JWT Tokenç®¡ç†ã€åœ¨çº¿ç”¨æˆ·ç›‘æ§ã€ç”¨æˆ·æƒé™æ•°æ®ç¼“å­˜ã€ä»ªè¡¨æ¿ç»Ÿè®¡æ•°æ®ç¼“å­˜

**åŒå†™ä¸€è‡´æ€§**
æˆ‘ä»¬é‡‡ç”¨"å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜"çš„ç­–ç•¥æ¥ä¿è¯åŒå†™ä¸€è‡´æ€§ï¼Œå…·ä½“å®ç°æ˜¯ï¼š

1. **å†™æ“ä½œæµç¨‹**ï¼šå…ˆæ›´æ–°æ•°æ®åº“ï¼ŒæˆåŠŸåå†åˆ é™¤Redisç¼“å­˜
2. **è¯»æ“ä½œæµç¨‹**ï¼šå…ˆæŸ¥Redisï¼Œæ²¡æœ‰åˆ™æŸ¥æ•°æ®åº“å¹¶å›å¡«ç¼“å­˜
3. **å¼‚å¸¸å¤„ç†**ï¼šå¦‚æœåˆ é™¤ç¼“å­˜å¤±è´¥ï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥é‡è¯•
4. **æœ€ç»ˆä¸€è‡´æ€§**ï¼šé€šè¿‡å»¶è¿ŸåŒåˆ å’Œé‡è¯•æœºåˆ¶ä¿è¯æœ€ç»ˆä¸€è‡´æ€§

ä¹Ÿå¯ä»¥é‡‡ç”¨çš„é˜¿é‡Œçš„Canalç»„ä»¶å®ç°æ•°æ®åŒæ­¥ï¼šä¸éœ€è¦æ›´æ”¹ä¸šåŠ¡ä»£ç ï¼Œåªéœ€éƒ¨ç½²ä¸€ä¸ªCanalæœåŠ¡ã€‚CanalæœåŠ¡æŠŠè‡ªå·±ä¼ªè£…æˆmysqlçš„ä¸€ä¸ªä»èŠ‚ç‚¹ã€‚å½“mysqlæ•°æ®æ›´æ–°ä»¥åï¼ŒCanalä¼šè¯»å–binlogæ•°æ®ï¼Œç„¶åå†é€šè¿‡Canalçš„å®¢æˆ·ç«¯è·å–åˆ°æ•°æ®ï¼Œå¹¶æ›´æ–°ç¼“å­˜å³å¯ã€‚

#### å¼€å‘å±‚é¢

1. XXL-JOBé›†æˆå’Œé…ç½®å›°éš¾
- é—®é¢˜ï¼šXXL-JOBçš„é…ç½®æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦æ·±å…¥ç†è§£å…¶æ¶æ„
- æŒ‘æˆ˜ï¼šè°ƒåº¦ä¸­å¿ƒå’Œæ‰§è¡Œå™¨çš„é…ç½®ã€ç½‘ç»œé€šä¿¡ã€ä»»åŠ¡æ³¨å†Œ
- è§£å†³æ–¹æ¡ˆï¼š
  * ä»”ç»†é˜…è¯»å®˜æ–¹æ–‡æ¡£å’Œæºç 
  * æ­å»ºæµ‹è¯•ç¯å¢ƒè¿›è¡Œè°ƒè¯•
  * ç¼–å†™è¯¦ç»†çš„é…ç½®æ–‡æ¡£

2. Dockerå®¹å™¨åŒ–éƒ¨ç½²é—®é¢˜
- é—®é¢˜ï¼šDockeré…ç½®é”™è¯¯å¯¼è‡´æœåŠ¡æ— æ³•æ­£å¸¸å¯åŠ¨
- æŒ‘æˆ˜ï¼šå®¹å™¨ç½‘ç»œé…ç½®ã€ç«¯å£æ˜ å°„ã€æ•°æ®å·æŒ‚è½½
- è§£å†³æ–¹æ¡ˆï¼š
  * ä½¿ç”¨docker-composeç®€åŒ–éƒ¨ç½²
  * ç¼–å†™è¯¦ç»†çš„éƒ¨ç½²è„šæœ¬
  * æ·»åŠ å¥åº·æ£€æŸ¥å’Œæ—¥å¿—ç›‘æ§

3. æƒé™ç®¡ç†ç³»ç»Ÿå¼€å‘å›°éš¾
- é—®é¢˜ï¼šRBACæƒé™ç®¡ç†éœ€è¦ç»†ç²’åº¦çš„æƒé™æ§åˆ¶
- æŒ‘æˆ˜ï¼šç”¨æˆ·-è§’è‰²-æƒé™çš„å¤æ‚å…³ç³»ã€åŠ¨æ€æƒé™éªŒè¯
- è§£å†³æ–¹æ¡ˆï¼š
  * è®¾è®¡æ¸…æ™°çš„æƒé™æ¨¡å‹
  * ä½¿ç”¨Spring Securityå®ç°æƒé™æ§åˆ¶
  * é€šè¿‡æ³¨è§£å®ç°ç»†ç²’åº¦æƒé™éªŒè¯

4. ç›‘æ§ç³»ç»Ÿå¼€å‘æŒ‘æˆ˜
- é—®é¢˜ï¼šéœ€è¦å®æ—¶ç›‘æ§ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€å’Œç³»ç»Ÿæ€§èƒ½
- æŒ‘æˆ˜ï¼šæ•°æ®é‡‡é›†ã€å®æ—¶å±•ç¤ºã€å‘Šè­¦æœºåˆ¶
- è§£å†³æ–¹æ¡ˆï¼š
  * ä½¿ç”¨WebSocketå®ç°å®æ—¶æ•°æ®æ¨é€
  * å®ç°è‡ªå®šä¹‰çš„å‘Šè­¦è§„åˆ™


## é¡¹ç›® - Excelå¤„ç†æ¡†æ¶

### 1. æ¶æ„è®¾è®¡ç›¸å…³é—®é¢˜

**Q1: Excelå¤„ç†æ¡†æ¶çš„æ•´ä½“æ¶æ„æ˜¯ä»€ä¹ˆï¼Ÿ**
#### æ¶æ„å±‚é¢

1. å¤§æ•°æ®å¤„ç†å†…å­˜æº¢å‡ºé—®é¢˜
- é—®é¢˜ï¼šå¤„ç†10ä¸‡çº§æ•°æ®æ—¶å‡ºç°OOMï¼ˆOut of Memoryï¼‰
- æŒ‘æˆ˜ï¼šExcelæ–‡ä»¶æ— æ³•ä¸€æ¬¡æ€§åŠ è½½åˆ°å†…å­˜
- è§£å†³æ–¹æ¡ˆï¼š
  * é‡‡ç”¨åˆ†ç‰‡å¤„ç†ç­–ç•¥ï¼Œæ¯ç‰‡å¤„ç†1ä¸‡è¡Œæ•°æ®
  * ä½¿ç”¨æµå¼è¯»å–ï¼Œè¾¹è¯»è¾¹å¤„ç†
  * ä¼˜åŒ–å†…å­˜ä½¿ç”¨ï¼ŒåŠæ—¶é‡Šæ”¾æ— ç”¨å¯¹è±¡

2. ç³»ç»Ÿæ¶æ„å¦‚ä½•åšçš„ï¼Ÿ
- å•ä½“æ¶æ„éƒ¨ç½²ï¼Œéƒ¨ç½²åœ¨æ‹›è¡Œå†…éƒ¨APIäº‘å¸‚åœºä¸­
- ä½¿ç”¨Spring Bootæ¡†æ¶å¼€å‘
- ä½¿ç”¨Redisç¼“å­˜çƒ­ç‚¹æ•°æ®ï¼ˆå¦‚ä»»åŠ¡çŠ¶æ€å’Œè¿›åº¦ä¿¡æ¯ï¼Œæ ¡éªŒè§„åˆ™ï¼Œä¸šåŠ¡é…ç½®æ•°æ®ï¼Œåˆ†ç‰‡å¤„ç†é”ï¼‰
- ä½¿ç”¨çº¿ç¨‹æ± æ§åˆ¶å¹¶å‘æ•°é‡
- ä½¿ç”¨å¼‚æ­¥å¤„ç†ï¼Œç«‹å³è¿”å›ä»»åŠ¡ID

3. æ•°æ®ä¸€è‡´æ€§ä¿è¯ï¼š
  - é—®é¢˜ï¼šå¹¶å‘å¤„ç†æ—¶æ•°æ®ä¸€è‡´æ€§å’Œå®Œæ•´æ€§
  - æŒ‘æˆ˜ï¼šå¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„æ•°æ®åŒæ­¥å’Œäº‹åŠ¡ç®¡ç†
  - è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨åˆ†å¸ƒå¼é”+æ•°æ®åº“äº‹åŠ¡+ç»“æœéªŒè¯

#### å¼€å‘å±‚é¢

1. Excelæ–‡ä»¶æ ¼å¼å…¼å®¹æ€§é—®é¢˜
- é—®é¢˜ï¼šä¸åŒç‰ˆæœ¬çš„Excelæ–‡ä»¶æ ¼å¼å·®å¼‚è¾ƒå¤§
- æŒ‘æˆ˜ï¼š.xlså’Œ.xlsxæ ¼å¼çš„å…¼å®¹æ€§ã€ç‰¹æ®Šå­—ç¬¦å¤„ç†
- è§£å†³æ–¹æ¡ˆï¼š
  * ä½¿ç”¨Apache POIåº“å¤„ç†å¤šç§æ ¼å¼ï¼šHSSFWorkbookå’ŒXSSFWorkbookæ¥å¤„ç†xlså’Œxlsxæ ¼å¼
  * å®ç°æ ¼å¼æ£€æµ‹å’Œè‡ªåŠ¨è½¬æ¢
  * æ·»åŠ ç‰¹æ®Šå­—ç¬¦è¿‡æ»¤å’Œç¼–ç å¤„ç†
  * ç¼–å†™è¯¦ç»†çš„æ ¼å¼éªŒè¯è§„åˆ™

2. å¼‚æ­¥å¤„ç†çŠ¶æ€è·Ÿè¸ªå›°éš¾
- é—®é¢˜ï¼šå¦‚ä½•å‡†ç¡®è·Ÿè¸ªå¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€
- æŒ‘æˆ˜ï¼šä»»åŠ¡è¿›åº¦å®æ—¶æ›´æ–°ã€å¼‚å¸¸çŠ¶æ€å¤„ç†
- è§£å†³æ–¹æ¡ˆï¼š
  * ä½¿ç”¨Rediså­˜å‚¨ä»»åŠ¡çŠ¶æ€å’Œè¿›åº¦
  * å®ç°å®šæ—¶ä»»åŠ¡æ›´æ–°è¿›åº¦ä¿¡æ¯
  * æ·»åŠ ä»»åŠ¡è¶…æ—¶å’Œé‡è¯•æœºåˆ¶
  * è®¾è®¡å®Œå–„çš„å¼‚å¸¸å¤„ç†æµç¨‹

3. ç¼“å­˜ç­–ç•¥è®¾è®¡å¤æ‚
- é—®é¢˜ï¼šå¦‚ä½•è®¾è®¡é«˜æ•ˆçš„ç¼“å­˜ç­–ç•¥
- æŒ‘æˆ˜ï¼šç¼“å­˜æ›´æ–°ã€ç¼“å­˜å¤±æ•ˆã€å†…å­˜ç®¡ç†
- è§£å†³æ–¹æ¡ˆï¼š
  * ä½¿ç”¨Redis Hashç»“æ„å­˜å‚¨å¤æ‚æ•°æ®
  * å®ç°ç¼“å­˜é¢„çƒ­å’Œæ›´æ–°ç­–ç•¥
  * è®¾ç½®åˆç†çš„ç¼“å­˜è¿‡æœŸæ—¶é—´
  * æ·»åŠ ç¼“å­˜ç›‘æ§å’Œå‘Šè­¦

### 2. å…·ä½“ä¸šåŠ¡é€»è¾‘æ˜¯ä»€ä¹ˆï¼Ÿ

#### å®¢æˆ·ä¿¡æ¯æ‰¹é‡å¯¼å…¥ä¸šåŠ¡é€»è¾‘

**é¢è¯•å›ç­”ï¼š**
```
è¿™ä¸ªé¡¹ç›®ä¸»è¦å¤„ç†æ‹›è¡Œå„åˆ†è¡Œçš„å®¢æˆ·ä¿¡æ¯ï¼ˆæ”¯æŒä¸åŒç‰ˆæœ¬ï¼Œæ¯”å¦‚åŸºç¡€ä¿¡æ¯ï¼Œä¸šåŠ¡ä¿¡æ¯ç­‰ä¸åŒè¡¨å¤´ï¼‰æ‰¹é‡å¯¼å…¥ã€‚å®¢æˆ·ç»ç†ä¸Šä¼ Excelæ–‡ä»¶åï¼Œç³»ç»Ÿä¼šæ™ºèƒ½è¯†åˆ«è¡¨å¤´ç»“æ„ï¼ˆæ”¯æŒå¤šçº§è¡¨å¤´ï¼‰ï¼Œç„¶åæŒ‰1ä¸‡è¡Œä¸€ä¸ªåˆ†ç‰‡è¿›è¡Œå¼‚æ­¥å¤„ç†ã€‚æ¯ä¸ªåˆ†ç‰‡ä¼šè¿›è¡Œä¸šåŠ¡è§„åˆ™æ ¡éªŒï¼ˆèº«ä»½è¯å·æ ¼å¼ã€æ‰‹æœºå·æ ¼å¼ã€ä¸šåŠ¡åˆè§„æ€§ç­‰ï¼‰ï¼Œæ•°æ®æ¸…æ´—è½¬æ¢ï¼ˆæ ¼å¼æ ‡å‡†åŒ–ã€å»é‡è¡¥å…¨ï¼‰ï¼Œæœ€åæ‰¹é‡å…¥åº“ï¼Œä¹Ÿå¯ä»¥æ ¹æ®éœ€æ±‚è½¬æˆåƒjsonè¿™ç±»çš„ç»“æ„ã€‚æ•´ä¸ªè¿‡ç¨‹æ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼Œå¦‚æœæŸæ¡è®°å½•æ ¡éªŒå¤±è´¥ï¼Œä¼šå•ç‹¬å¯¼å‡ºä¾›å®¢æˆ·ç»ç†ä¿®æ­£ã€‚
```

#### çº¿ç¨‹æ± å¼‚æ­¥åˆ†ç‰‡çš„åŸå› 

**é¢è¯•å›ç­”ï¼š**
```
ä½¿ç”¨çº¿ç¨‹æ± å¼‚æ­¥åˆ†ç‰‡ä¸»è¦è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼š

ç¬¬ä¸€ï¼Œå†…å­˜æº¢å‡ºé—®é¢˜ã€‚æ‹›è¡Œçš„å®¢æˆ·æ•°æ®é‡å¾ˆå¤§ï¼Œä¸€ä¸ªExcelæ–‡ä»¶å¯èƒ½æœ‰å‡ åä¸‡è¡Œï¼Œå¦‚æœä¸€æ¬¡æ€§åŠ è½½åˆ°å†…å­˜ä¼šç›´æ¥OOMã€‚é€šè¿‡åˆ†ç‰‡å¤„ç†ï¼Œæ¯æ¬¡åªå¤„ç†1ä¸‡è¡Œæ•°æ®ï¼Œæœ‰æ•ˆæ§åˆ¶å†…å­˜ä½¿ç”¨ã€‚

ç¬¬äºŒï¼Œæ€§èƒ½ç“¶é¢ˆé—®é¢˜ã€‚å•çº¿ç¨‹å¤„ç†å¤§æ–‡ä»¶ä¼šå¾ˆæ…¢ï¼Œç”¨æˆ·ç­‰å¾…æ—¶é—´é•¿ã€‚ä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªåˆ†ç‰‡ï¼Œæ¯”å¦‚10ä¸ªçº¿ç¨‹å¹¶è¡Œå¤„ç†ï¼Œå¤„ç†é€Ÿåº¦èƒ½æå‡5-10å€ã€‚

ç¬¬ä¸‰ï¼Œç”¨æˆ·ä½“éªŒé—®é¢˜ã€‚å¼‚æ­¥å¤„ç†è®©ç”¨æˆ·å¯ä»¥ç«‹å³å¾—åˆ°ä»»åŠ¡IDï¼Œç„¶åé€šè¿‡è¿›åº¦æ¡å®æ—¶æŸ¥çœ‹å¤„ç†è¿›åº¦ï¼Œè€Œä¸æ˜¯ä¸€ç›´ç­‰å¾…åˆ°å¤„ç†å®Œæˆã€‚
```

#### Redisç¼“å­˜çš„åŸå› 

**é¢è¯•å›ç­”ï¼š**
```
Redisç¼“å­˜ä¸»è¦è§£å†³ä¸‰ä¸ªé—®é¢˜ï¼š

ç¬¬ä¸€ï¼Œå¤„ç†è¿›åº¦è·Ÿè¸ªã€‚æ¯ä¸ªåˆ†ç‰‡çš„å¤„ç†çŠ¶æ€ã€è¿›åº¦ç™¾åˆ†æ¯”ã€é”™è¯¯ä¿¡æ¯éƒ½éœ€è¦å®æ—¶æ›´æ–°ï¼ŒRedisçš„Hashç»“æ„éå¸¸é€‚åˆå­˜å‚¨è¿™ç§é”®å€¼å¯¹æ•°æ®ï¼Œæ”¯æŒå®æ—¶æŸ¥è¯¢å’Œæ›´æ–°ã€‚
Redisçš„hashå¤§æ¦‚é•¿è¿™æ ·ï¼šKey â†’ { field1: value1, field2: value2, field3: value3, ... }

```
Key: task_progress:{taskId}
Value: {
  "total_chunks": 10,
  "completed_chunks": 3,
  "current_chunk": 4,
  "status": "PROCESSING",
  "start_time": 1699123456
}
```
ç¬¬äºŒï¼Œæ–­ç‚¹ç»­ä¼ æ”¯æŒã€‚å¦‚æœç³»ç»Ÿé‡å¯æˆ–æŸä¸ªåˆ†ç‰‡å¤±è´¥ï¼Œå¯ä»¥ä»Redisä¸­æ¢å¤å¤„ç†çŠ¶æ€ï¼Œä¸éœ€è¦é‡æ–°å¼€å§‹æ•´ä¸ªä»»åŠ¡ï¼Œè¿™å¯¹ç”¨æˆ·ä½“éªŒå¾ˆé‡è¦ã€‚
  - ä¸æ˜¯çœŸæ­£çš„"æ–­ç‚¹"ï¼š è€Œæ˜¯é€šè¿‡è®°å½•å¤„ç†ä½ç½®å®ç°"ä»å“ªé‡Œç»§ç»­"
  - å®šæœŸä¿å­˜ï¼š ä¸æ˜¯æ¯å¤„ç†ä¸€è¡Œéƒ½ä¿å­˜ï¼Œè€Œæ˜¯æ‰¹é‡ä¿å­˜ï¼Œå¹³è¡¡æ€§èƒ½å’Œå¯é æ€§
  - çŠ¶æ€å®Œæ•´æ€§ï¼š éœ€è¦è®°å½•åˆ†ç‰‡çŠ¶æ€ã€å¤„ç†è¿›åº¦ã€é”™è¯¯ä¿¡æ¯ç­‰å®Œæ•´ä¿¡æ¯ 

ç¬¬ä¸‰ï¼Œé…ç½®æ•°æ®ç¼“å­˜ã€‚å®¢æˆ·ç±»å‹ã€é£é™©ç­‰çº§ã€è¡Œä¸šåˆ†ç±»ç­‰é…ç½®ä¿¡æ¯å˜åŒ–ä¸é¢‘ç¹ï¼Œä½†æŸ¥è¯¢é¢‘ç‡å¾ˆé«˜ã€‚ç¼“å­˜åˆ°Rediså¯ä»¥å‡å°‘æ•°æ®åº“æŸ¥è¯¢ï¼Œæå‡å…¶ä»–æ¥å£çš„å“åº”é€Ÿåº¦ã€‚
```

#### Redisé€‰æ‹©Hashç»“æ„çš„åŸå› 

| ä¼˜åŠ¿ | å…·ä½“è¡¨ç° | ä¸šåŠ¡ä»·å€¼ |
|------|----------|----------|
| **å¤©ç„¶é€‚åˆé”®å€¼å¯¹æ•°æ®** | ä¸“é—¨ä¸ºå­˜å‚¨å¯¹è±¡è®¾è®¡ï¼ŒåŒ…å«å¤šä¸ªfield-valueå¯¹ | å®Œç¾åŒ¹é…é”™è¯¯ä¿¡æ¯å’ŒçŠ¶æ€æ•°æ®ç»“æ„ |
| **åŸå­æ€§æ“ä½œæ”¯æŒ** | æ”¯æŒåŸå­æ€§çš„å­—æ®µæ“ä½œï¼Œå¤šçº¿ç¨‹æ›´æ–°ä¸å†²çª | ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œé¿å…å¹¶å‘é—®é¢˜ |
| **éƒ¨åˆ†æ›´æ–°æ•ˆç‡é«˜** | åªéœ€æ›´æ–°å˜åŒ–å­—æ®µï¼Œæ— éœ€é‡å†™æ•´ä¸ªå¯¹è±¡ | æå‡æ€§èƒ½ï¼Œé¿å…ä¸å¿…è¦çš„åºåˆ—åŒ–å¼€é”€ |
| **æŸ¥è¯¢çµæ´»** | æ”¯æŒå•å­—æ®µã€å¤šå­—æ®µã€å…¨å­—æ®µæŸ¥è¯¢ | æ»¡è¶³ä¸åŒæŸ¥è¯¢éœ€æ±‚ï¼Œæå‡å¼€å‘çµæ´»æ€§ |
| **å†…å­˜æ•ˆç‡é«˜** | æ¯”å¤šä¸ªç‹¬ç«‹String keyæ›´èŠ‚çœå†…å­˜ | å‡å°‘Rediså†…å­˜å¼€é”€ï¼Œæå‡ç³»ç»Ÿæ€§èƒ½ |
| **æ‰¹é‡æ“ä½œæ”¯æŒ** | æ”¯æŒæ‰¹é‡è®¾ç½®å’Œè·å–å¤šä¸ªå­—æ®µ | æå‡æ“ä½œæ•ˆç‡ï¼Œå‡å°‘ç½‘ç»œå¾€è¿” |
| **é€‚åˆåˆ†ç‰‡å¤„ç†åœºæ™¯** | å¤©ç„¶é€‚åˆç®¡ç†å¤šå­—æ®µçš„ç»“æ„åŒ–æ•°æ® | å®Œç¾å¥‘åˆåˆ†ç‰‡å¤„ç†çš„çŠ¶æ€ç®¡ç†éœ€æ±‚ |

**æ ¸å¿ƒä»·å€¼ï¼š** Hashç»“æ„åœ¨Redisä¸­å¤„ç†å¯¹è±¡æ•°æ®æ—¶ï¼Œæä¾›äº†åŸå­æ€§ã€é«˜æ•ˆæ€§ã€çµæ´»æ€§å’Œå†…å­˜æ•ˆç‡çš„å®Œç¾å¹³è¡¡ï¼Œæ˜¯å­˜å‚¨åˆ†ç‰‡å¤„ç†çŠ¶æ€ä¿¡æ¯çš„æœ€ä½³é€‰æ‹©ã€‚

#### æŠ€æœ¯æ¶æ„çš„ä¼˜åŠ¿

**é¢è¯•å›ç­”ï¼š**
```
è¿™ä¸ªæ¶æ„çš„ä¼˜åŠ¿æ˜¯ï¼š

å¯æ‰©å±•æ€§å¼ºï¼šå¯ä»¥é€šè¿‡å¢åŠ çº¿ç¨‹æ± å¤§å°æ¥æå‡å¹¶å‘å¤„ç†èƒ½åŠ›ï¼Œé€šè¿‡å¢åŠ Redisé›†ç¾¤æ¥æå‡ç¼“å­˜æ€§èƒ½ã€‚

å®¹é”™æ€§å¥½ï¼šå•ä¸ªåˆ†ç‰‡å¤±è´¥ä¸å½±å“å…¶ä»–åˆ†ç‰‡ï¼ŒRedisçš„æŒä¹…åŒ–æœºåˆ¶ä¿è¯æ•°æ®ä¸ä¸¢å¤±ã€‚

ç›‘æ§å‹å¥½ï¼šå¯ä»¥å®æ—¶ç›‘æ§æ¯ä¸ªåˆ†ç‰‡çš„å¤„ç†çŠ¶æ€ï¼Œå¿«é€Ÿå®šä½æ€§èƒ½ç“¶é¢ˆå’Œé”™è¯¯åŸå› ã€‚

èµ„æºåˆ©ç”¨ç‡é«˜ï¼šçº¿ç¨‹æ± é¿å…äº†é¢‘ç¹åˆ›å»ºé”€æ¯çº¿ç¨‹çš„å¼€é”€ï¼ŒRedisç¼“å­˜å®ç°äº†è¿›åº¦ç›‘æ§å’Œæ–­ç‚¹ç»­ä¼ ã€‚
```

**æ€»ç»“å›ç­”ï¼š**
```
æ‰€ä»¥é€‰æ‹©çº¿ç¨‹æ± å¼‚æ­¥åˆ†ç‰‡+Redisç¼“å­˜ï¼Œæ˜¯å› ä¸ºè¿™ä¸ªç»„åˆèƒ½å¤Ÿæœ‰æ•ˆè§£å†³å¤§æ•°æ®é‡å¤„ç†çš„å†…å­˜é—®é¢˜ã€æ€§èƒ½é—®é¢˜å’Œç”¨æˆ·ä½“éªŒé—®é¢˜ï¼ŒåŒæ—¶æä¾›äº†è‰¯å¥½çš„å¯æ‰©å±•æ€§å’Œå®¹é”™æ€§ã€‚
```

## æ‹›è¡Œé¡¹ç›® - æ¶ˆæ¯é€šçŸ¥æœåŠ¡

### é¡¹ç›®èƒŒæ™¯

**é¢è¯•å®˜é—®ï¼š"è¿™ä¸ªé¡¹ç›®ä¸»è¦åšä»€ä¹ˆï¼Ÿ"**

**ä½ çš„å›ç­”ï¼š**

è¿™æ˜¯æ‹›è¡Œçš„ç»Ÿä¸€æ¶ˆæ¯é€šçŸ¥æœåŠ¡ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å°è£…é‚®ä»¶ã€çŸ­ä¿¡ã€åº”ç”¨æ¶ˆæ¯ç­‰ä¸åŒç±»å‹çš„æ¶ˆæ¯å‘é€åŠŸèƒ½ï¼Œä¸ºä¸Šæ¸¸ä¸šåŠ¡ç³»ç»Ÿæä¾›ç»Ÿä¸€çš„æ¶ˆæ¯å‘é€æ¥å£ã€‚ç³»ç»Ÿéœ€è¦æ”¯æŒåŠ¨æ€æ‰©å±•ï¼Œæå‡ç³»ç»Ÿé—´æ¶ˆæ¯ç»Ÿä¸€æ€§ä¸å¯ç»´æŠ¤æ€§ã€‚

**ç›´æ¥è°ƒç”¨çš„é—®é¢˜**
1. ä¸šåŠ¡ç³»ç»Ÿéœ€è¦äº†è§£æ¯ä¸ªæœåŠ¡å•†çš„APIç»†èŠ‚
2. æ— æ³•ç»Ÿä¸€å¤„ç†é‡è¯•ã€ç›‘æ§ã€é™æµç­‰é€šç”¨é€»è¾‘
3. ä»£ç é‡å¤ï¼Œç»´æŠ¤æˆæœ¬é«˜ã€

é™¤äº†å°è£…ï¼Œæ·»åŠ äº†å“ªäº›**æ–°åŠŸèƒ½**ï¼Ÿ
1. ä¿®æ”¹æºä»£ç ï¼Œè®©ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰è¡Œå†…ä¸åŒçš„æœºå™¨äººå‘é€è€…
2. åŸæ¥çš„æ¥å£æ²¡æœ‰é‡è¯•åŠŸèƒ½ï¼Œå¦‚æœç½‘ç»œæŠ–åŠ¨å¯¼è‡´å‘é€å¤±è´¥ï¼Œç”¨æˆ·éœ€è¦æ‰‹åŠ¨é‡è¯•ã€‚

æˆ‘ä»¬å°è£…åæ·»åŠ äº†æ™ºèƒ½é‡è¯•ï¼š
- ç½‘ç»œé”™è¯¯è‡ªåŠ¨é‡è¯•3æ¬¡ï¼Œæ¯æ¬¡é—´éš”é€’å¢ï¼ˆ1ç§’ã€2ç§’ã€4ç§’ï¼‰
- å‚æ•°é”™è¯¯ä¸é‡è¯•ï¼ˆå¦‚æ‰‹æœºå·æ ¼å¼é”™è¯¯ï¼‰
- é‡è¯•è¿‡ç¨‹ä¸­å®æ—¶æ›´æ–°çŠ¶æ€ï¼Œç”¨æˆ·å¯ä»¥çœ‹åˆ°"æ­£åœ¨é‡è¯•ç¬¬2æ¬¡"
- æœ€ç»ˆå¤±è´¥åï¼Œæä¾›è¯¦ç»†çš„å¤±è´¥åŸå› å’Œé‡è¯•å»ºè®®

è¿™æ ·å¤§å¤§æå‡äº†å‘é€æˆåŠŸç‡ï¼Œç”¨æˆ·ä½“éªŒä¹Ÿæ›´å¥½ã€‚


### âŒ ç¢°åˆ°çš„ä¸»è¦å›°éš¾
ä¸»è¦ç¢°åˆ°äº†ä¸¤ä¸ªæ ¸å¿ƒå›°éš¾ï¼š

1. **æ¶ˆæ¯ç±»å‹æ‰©å±•å›°éš¾**ï¼šåˆæœŸç¡¬ç¼–ç äº†é‚®ä»¶ã€çŸ­ä¿¡ç­‰å‘é€é€»è¾‘ï¼Œæ¯æ¬¡æ–°å¢æ¶ˆæ¯ç±»å‹éƒ½éœ€è¦ä¿®æ”¹æ ¸å¿ƒä»£ç ï¼Œè¿åäº†å¼€é—­åŸåˆ™ã€‚

2. **æ¥å£ä¸ç»Ÿä¸€é—®é¢˜**ï¼šAPIæ¥å£å¤šï¼Œä¸šåŠ¡ç³»ç»Ÿè°ƒç”¨æ—¶éœ€è¦äº†è§£å…·ä½“çš„å®ç°ç»†èŠ‚æ‰èƒ½æ”¾å…¥ä»£ç ï¼Œå¢åŠ äº†ä½¿ç”¨å¤æ‚åº¦ã€‚

**ä»£ç è€¦åˆåº¦é«˜**ï¼šæ¶ˆæ¯å‘é€é€»è¾‘ä¸ä¸šåŠ¡é€»è¾‘æ··åœ¨ä¸€èµ·ï¼Œä¿®æ”¹æ¶ˆæ¯ç±»å‹ä¼šå½±å“ä¸šåŠ¡ä»£ç ã€‚

**æ‰©å±•æ€§å·®**ï¼šæ–°å¢æ¶ˆæ¯ç±»å‹éœ€è¦ä¿®æ”¹ç°æœ‰ä»£ç ï¼Œå®¹æ˜“å¼•å…¥bugï¼Œæµ‹è¯•æˆæœ¬é«˜ã€‚

**ç»´æŠ¤å›°éš¾**ï¼šä¸åŒæ¶ˆæ¯ç±»å‹çš„å®ç°é€»è¾‘åˆ†æ•£åœ¨å„ä¸ªåœ°æ–¹ï¼Œéš¾ä»¥ç»Ÿä¸€ç®¡ç†å’Œä¼˜åŒ–ã€‚

**æ¥å£ä¸ä¸€è‡´**ï¼šä¸šåŠ¡ç³»ç»Ÿéœ€è¦è°ƒç”¨ä¸åŒçš„æ¥å£ï¼Œå¢åŠ äº†é›†æˆéš¾åº¦ã€‚

### ğŸ› ï¸ è§£å†³æ–¹æ¡ˆï¼šç­–ç•¥+å·¥å‚æ¨¡å¼

æˆ‘ä½¿ç”¨ç­–ç•¥æ¨¡å¼+å·¥å‚æ¨¡å¼æ¥è§£å†³è¿™äº›é—®é¢˜ï¼š

**ç­–ç•¥æ¨¡å¼çš„åº”ç”¨ï¼š**
- å®šä¹‰ç»Ÿä¸€çš„æ¶ˆæ¯å‘é€æ¥å£`MessageSender`
- ä¸ºæ¯ç§æ¶ˆæ¯ç±»å‹å®ç°å…·ä½“çš„ç­–ç•¥ç±»ï¼š
  * `EmailSender`ï¼šå¤„ç†é‚®ä»¶å‘é€
  * `SmsSender`ï¼šå¤„ç†çŸ­ä¿¡å‘é€  
  * `AppMessageSender`ï¼šå¤„ç†åº”ç”¨å†…æ¶ˆæ¯æ¨é€

**å·¥å‚æ¨¡å¼çš„åº”ç”¨ï¼š**
- åˆ›å»º`MessageSenderFactory`å·¥å‚ç±»
- æ ¹æ®æ¶ˆæ¯ç±»å‹åŠ¨æ€åˆ›å»ºå¯¹åº”çš„å‘é€å™¨å®ä¾‹
- æ”¯æŒè¿è¡Œæ—¶é…ç½®ï¼Œæ— éœ€é‡å¯æœåŠ¡

**ç®€å•å·¥å‚æ¨¡å¼çš„åº”ç”¨ï¼š**
- åˆ›å»º`MessageSenderFactory`å·¥å‚ç±»
- æ ¹æ®æ¶ˆæ¯ç±»å‹å­—ç¬¦ä¸²ï¼ˆå¦‚"email"ã€"sms"ã€"app"ï¼‰åŠ¨æ€åˆ›å»ºå¯¹åº”çš„å‘é€å™¨å®ä¾‹
- ä½†æ˜¯ è¿åå¼€é—­åŸåˆ™ï¼šæ–°å¢ç­–ç•¥éœ€è¦ä¿®æ”¹å·¥å‚ä»£ç  åç»­ä¼˜åŒ–-ã€‹Springå®¹å™¨ç®¡ç†
  - å®Œå…¨ç¬¦åˆå¼€é—­åŸåˆ™ï¼šæ–°å¢ç­–ç•¥æ— éœ€ä¿®æ”¹å·¥å‚ä»£ç 
  - è‡ªåŠ¨æ³¨å…¥ï¼šSpringè‡ªåŠ¨ç®¡ç†ç­–ç•¥å®ä¾‹ï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†
  - æ”¯æŒçƒ­æ›´æ–°ï¼šå¯ä»¥é€šè¿‡é…ç½®ä¸­å¿ƒåŠ¨æ€è°ƒæ•´
  - æ˜“äºæµ‹è¯•ï¼šå¯ä»¥è½»æ¾Mockç­–ç•¥ç±»

### å…·ä½“å®ç°ä¼˜åŠ¿

è¿™ç§è®¾è®¡å¸¦æ¥çš„ä¼˜åŠ¿ï¼š

1. **å¼€é—­åŸåˆ™**ï¼šæ–°å¢æ¶ˆæ¯ç±»å‹åªéœ€å®ç°æ–°ç­–ç•¥ï¼Œæ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç 
2. **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªç­–ç•¥ç±»åªè´Ÿè´£ä¸€ç§æ¶ˆæ¯ç±»å‹çš„å‘é€é€»è¾‘
3. **ä¾èµ–å€’ç½®**ï¼šä¸šåŠ¡ä»£ç ä¾èµ–æŠ½è±¡æ¥å£ï¼Œä¸ä¾èµ–å…·ä½“å®ç°
4. **æ˜“äºæµ‹è¯•**ï¼šæ¯ä¸ªç­–ç•¥å¯ä»¥ç‹¬ç«‹æµ‹è¯•ï¼Œæé«˜æµ‹è¯•è¦†ç›–ç‡
5. **é…ç½®çµæ´»**ï¼šé€šè¿‡Nacosé…ç½®ä¸­å¿ƒåŠ¨æ€è°ƒæ•´æ¶ˆæ¯ç­–ç•¥


## å¤§å­¦é¡¹ç›® - äº‘å¹³å°æ•°æ®åˆ†æ
### 1. ESå¦‚ä½•ä¼˜åŒ–çš„
#### é›†ç¾¤
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   K8s Node 1   â”‚    â”‚   K8s Node 2   â”‚    â”‚   K8s Node 3   â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ESå®ä¾‹1   â”‚  â”‚    â”‚  â”‚ ESå®ä¾‹2   â”‚  â”‚    â”‚  â”‚ ESå®ä¾‹3   â”‚  â”‚
â”‚  â”‚           â”‚  â”‚    â”‚  â”‚           â”‚  â”‚    â”‚  â”‚           â”‚  â”‚
â”‚  â”‚ ä¸»åˆ†ç‰‡1   â”‚  â”‚    â”‚  â”‚ ä¸»åˆ†ç‰‡2   â”‚  â”‚    â”‚  â”‚ ä¸»åˆ†ç‰‡3   â”‚  â”‚
â”‚  â”‚ å‰¯æœ¬åˆ†ç‰‡3 â”‚  â”‚    â”‚  â”‚ å‰¯æœ¬åˆ†ç‰‡1 â”‚  â”‚    â”‚  â”‚ å‰¯æœ¬åˆ†ç‰‡2 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   ESé›†ç¾¤åè°ƒ    â”‚
                    â”‚                 â”‚
                    â”‚  - åˆ†ç‰‡è·¯ç”±     â”‚
                    â”‚  - è´Ÿè½½å‡è¡¡     â”‚
                    â”‚  - æ•…éšœè½¬ç§»     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å®šæ—¶å†™å…¥ä¼˜åŒ–
- **æ‰¹é‡å†™å…¥ç­–ç•¥**ï¼šFission CronJobå†™å…¥æ—¶ï¼Œè®¾ç½®åˆé€‚çš„æ‰¹é‡å¤§å°ï¼ˆ1000-5000æ¡ï¼‰ï¼Œå‡å°‘ESå†™å…¥é¢‘ç‡
- **åˆ·æ–°é—´éš”è°ƒæ•´**ï¼šå†™å…¥æœŸé—´å°†refresh_intervalè®¾ç½®ä¸º60ç§’ï¼Œå†™å…¥å®Œæˆåæ¢å¤ä¸º1ç§’ï¼Œå¹³è¡¡å†™å…¥æ€§èƒ½å’ŒæŸ¥è¯¢å®æ—¶æ€§

#### ç´¢å¼•è®¾è®¡ä¼˜åŒ–
- **æ—¶é—´åˆ†ç‰‡ç­–ç•¥**ï¼šæŒ‰å¤©æˆ–æŒ‰å‘¨åˆ›å»ºç´¢å¼•ï¼Œé¿å…å•ä¸ªç´¢å¼•è¿‡å¤§ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½
- **å­—æ®µæ˜ å°„ä¼˜åŒ–**ï¼šç¤¾äº¤åª’ä½“æ•°æ®çš„å…³é”®å­—æ®µï¼ˆç”¨æˆ·ID(keyword)ã€å†…å®¹(text)ã€æ—¶é—´æˆ³(date)ï¼‰ä½¿ç”¨åˆé€‚çš„ç±»å‹ï¼Œé¿å…ä¸å¿…è¦çš„åˆ†è¯

#### æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–
- **æŸ¥è¯¢ç¼“å­˜**ï¼šPythonæœåŠ¡é¢‘ç¹æŸ¥è¯¢çš„æ•°æ®è®¾ç½®æŸ¥è¯¢ç¼“å­˜ï¼Œå‡å°‘é‡å¤è®¡ç®—ï¼ˆæ ¹æ®æ…¢æ—¥å¿—ã€æŸ¥è¯¢é¢‘ç‡ç»Ÿè®¡ã€ä¸šåŠ¡åœºæ™¯åˆ¤æ–­ï¼‰
- **èšåˆä¼˜åŒ–**ï¼šæ•°æ®åˆ†æå¸¸ç”¨çš„èšåˆæŸ¥è¯¢ï¼ˆå¦‚æŒ‰æ—¶é—´ç»Ÿè®¡ã€æŒ‰å¹³å°ç»Ÿè®¡ï¼‰é¢„è®¡ç®—å¹¶ç¼“å­˜ç»“æœ
- **åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–**ï¼šæ”¯æŒæ·±åº¦åˆ†é¡µçš„search_afteræœºåˆ¶ï¼Œé¿å…æ·±åº¦åˆ†é¡µçš„æ€§èƒ½é—®é¢˜

#### ç›‘æ§å’Œè°ƒä¼˜
- **æ€§èƒ½ç›‘æ§**ï¼šç›‘æ§å†™å…¥å»¶è¿Ÿã€æŸ¥è¯¢å“åº”æ—¶é—´ã€é›†ç¾¤èµ„æºä½¿ç”¨ç‡ç­‰å…³é”®æŒ‡æ ‡
- **æ…¢æŸ¥è¯¢åˆ†æ**ï¼šå¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œè¯†åˆ«æ€§èƒ½ç“¶é¢ˆå¹¶è¿›è¡Œä¼˜åŒ–
- **èµ„æºè°ƒä¼˜**ï¼šæ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µï¼ŒåŠ¨æ€è°ƒæ•´ESé›†ç¾¤é…ç½®

## åŠ å¯†è´§å¸äº¤æ˜“å¹³å°
### 1. å›°éš¾å’Œè§£å†³

#### æ¶æ„å±‚é¢å›°éš¾

**1. é«˜å¹¶å‘æ’®åˆå¼•æ“è®¾è®¡æŒ‘æˆ˜**
- **é—®é¢˜**ï¼šå¦‚ä½•è®¾è®¡æ”¯æŒ10ä¸‡+ TPSçš„è®¢å•æ’®åˆç³»ç»Ÿ
- **æŒ‘æˆ˜**ï¼šè®¢å•åŒ¹é…ç®—æ³•å¤æ‚åº¦é«˜ï¼Œéœ€è¦ä¿è¯å…¬å¹³æ€§å’Œå®æ—¶æ€§
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  * é‡‡ç”¨RabbitMQ + Disruptorå¼‚æ­¥æ¶æ„ï¼Œå®ç°è®¢å•é˜Ÿåˆ—åŒ–å¤„ç†
  * è®¾è®¡é«˜æ•ˆçš„æ’®åˆç®—æ³•ï¼ŒæŒ‰ä»·æ ¼ä¼˜å…ˆã€æ—¶é—´ä¼˜å…ˆåŸåˆ™æ’åº
  * ä½¿ç”¨å†…å­˜æ•°æ®ç»“æ„ä¼˜åŒ–è®¢å•åŒ¹é…æ€§èƒ½

**2. å¾®æœåŠ¡æ¶æ„å¤æ‚æ€§ç®¡ç†**
- **é—®é¢˜**ï¼šå¤šä¸ªå¾®æœåŠ¡é—´çš„åè°ƒå’Œé€šä¿¡å¤æ‚æ€§ï¼ˆæ¯”å¦‚è®¢å•æœåŠ¡ã€æ’®åˆæœåŠ¡ã€è´¢åŠ¡æœåŠ¡ã€ä¼šå‘˜æœåŠ¡ç­‰ï¼‰
- **æŒ‘æˆ˜**ï¼šæœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†ã€è´Ÿè½½å‡è¡¡çš„ç»Ÿä¸€ç®¡ç†
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  * åŸºäºNacoså®ç°æœåŠ¡æ³¨å†Œå‘ç°å’Œé…ç½®ä¸­å¿ƒ
  * ä½¿ç”¨LoadBalancerå®ç°æ™ºèƒ½è´Ÿè½½å‡è¡¡
  * è®¾è®¡æœåŠ¡é—´é€šä¿¡çš„æ ‡å‡†åŒ–æ¥å£

**3. åˆ†å¸ƒå¼ç³»ç»Ÿä¸€è‡´æ€§ä¿è¯**
- **é—®é¢˜**ï¼šå¤šæœåŠ¡ç¯å¢ƒä¸‹å¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§
- **æŒ‘æˆ˜**ï¼šè®¢å•çŠ¶æ€åŒæ­¥ã€è´¦æˆ·ä½™é¢ä¸€è‡´æ€§ã€åˆ†å¸ƒå¼äº‹åŠ¡
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  * ä½¿ç”¨JetCache + Rediså®ç°åˆ†å¸ƒå¼é”
  * è®¾è®¡æœ€ç»ˆä¸€è‡´æ€§çš„äº‹åŠ¡æ¨¡å‹
  * å®ç°è¡¥å¿æœºåˆ¶å¤„ç†å¼‚å¸¸æƒ…å†µ

```
ä¸¾ä¸ªå…·ä½“ä¾‹å­ï¼šç”¨æˆ·ä¸‹å•ä¹°æ¯”ç‰¹å¸ï¼Œç³»ç»Ÿå…ˆå†»ç»“ä½™é¢ï¼ˆæœ¬åœ°äº‹åŠ¡ï¼‰ï¼Œç„¶åå‘é€è®¢å•åˆ°æ’®åˆå¼•æ“ã€‚å¦‚æœæ’®åˆå¤±è´¥ï¼Œè¡¥å¿æœºåˆ¶ä¼šè‡ªåŠ¨è§£å†»ä½™é¢å¹¶å–æ¶ˆè®¢å•ï¼›å¦‚æœæ’®åˆæˆåŠŸä½†æ‰£å‡ä½™é¢å¤±è´¥ï¼Œè¡¥å¿æœºåˆ¶ä¼šå–æ¶ˆæ’®åˆç»“æœå¹¶è§£å†»ä½™é¢ã€‚è¿™æ ·ä¿è¯äº†æ— è®ºå“ªä¸ªç¯èŠ‚å¤±è´¥ï¼Œç”¨æˆ·èµ„é‡‘éƒ½ä¸ä¼šä¸¢å¤±ï¼Œæœ€ç»ˆè¾¾åˆ°æ•°æ®ä¸€è‡´æ€§ã€‚
```

#### 2. å¼€å‘å±‚é¢å›°éš¾

**1. å®æ—¶è¡Œæƒ…æ¨é€æ€§èƒ½ä¼˜åŒ–**
- **é—®é¢˜**ï¼šWebSocketè¿æ¥æ•°æ¿€å¢å¯¼è‡´æ€§èƒ½ä¸‹é™
- **æŒ‘æˆ˜**ï¼šå¤§é‡å¹¶å‘è¿æ¥ã€æ¶ˆæ¯å¹¿æ’­æ•ˆç‡ã€è¿æ¥ç®¡ç†
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  * å®ç°è¿æ¥æ± ç®¡ç†ï¼Œå¤ç”¨WebSocketè¿æ¥
  * ä½¿ç”¨æ¶ˆæ¯å‹ç¼©å‡å°‘ç½‘ç»œä¼ è¾“
  * è®¾è®¡åˆ†å±‚æ¨é€ç­–ç•¥ï¼Œé¿å…æ— æ•ˆæ¨é€

**2. åˆ†å¸ƒå¼IDç”Ÿæˆç³»ç»Ÿè®¾è®¡**
- **é—®é¢˜**ï¼šå¦‚ä½•åœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹ç”Ÿæˆå…¨å±€å”¯ä¸€ID
- **æŒ‘æˆ˜**ï¼šIDå”¯ä¸€æ€§ã€æ€§èƒ½è¦æ±‚ã€æ—¶é’Ÿå›æ‹¨é—®é¢˜
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  * ä½¿ç”¨Snowflakeç®—æ³•ï¼Œç»“åˆæœºå™¨IDå’Œåºåˆ—å·
  * å¤„ç†æ—¶é’Ÿå›æ‹¨é—®é¢˜ï¼Œç¡®ä¿IDå•è°ƒé€’å¢
  * ä¼˜åŒ–IDç”Ÿæˆæ€§èƒ½ï¼Œæ”¯æŒæ‰¹é‡ç”Ÿæˆ

**3. å®‰å…¨è®¤è¯ä½“ç³»å®ç°**
- **é—®é¢˜**ï¼šå¦‚ä½•è®¾è®¡è·¨æœåŠ¡çš„ç»Ÿä¸€è®¤è¯æˆæƒ
- **æŒ‘æˆ˜**ï¼šJWTä»¤ç‰Œç®¡ç†ã€æƒé™éªŒè¯ã€å®‰å…¨é˜²æŠ¤
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  * å®ç°OAuth2 + JWTè®¤è¯æµç¨‹
  * è®¾è®¡ä»¤ç‰Œåˆ·æ–°å’Œå¤±æ•ˆæœºåˆ¶
  * æ·»åŠ é˜²é‡æ”¾æ”»å‡»å’ŒXSSé˜²æŠ¤

**4. äº‘åŸç”Ÿéƒ¨ç½²å¤æ‚æ€§**
- **é—®é¢˜**ï¼šDockerå®¹å™¨åŒ–éƒ¨ç½²å’Œè¿ç»´ç®¡ç†
- **æŒ‘æˆ˜**ï¼šå®¹å™¨ç¼–æ’ã€æœåŠ¡å‘ç°ã€ç›‘æ§å‘Šè­¦
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  * ä½¿ç”¨Docker Composeç®€åŒ–å¤šæœåŠ¡éƒ¨ç½²
  * å®ç°å¥åº·æ£€æŸ¥å’Œè‡ªåŠ¨é‡å¯æœºåˆ¶
  * é›†æˆç›‘æ§ç³»ç»Ÿï¼Œå®æ—¶ç›‘æ§æœåŠ¡çŠ¶æ€

## ğŸš¨ é¢è¯•å®˜æŒ–å‘åº”å¯¹æ–¹æ¡ˆ

### 1. åˆ†å¸ƒå¼ä¸€è‡´æ€§æ–¹æ¡ˆæ·±åº¦è§£æ

#### è¡¥å¿æœºåˆ¶å¤±è´¥å¤„ç†æ–¹æ¡ˆ

**Q: è¡¥å¿æœºåˆ¶å¤±è´¥æ€ä¹ˆåŠï¼Ÿå¦‚ä½•ä¿è¯è¡¥å¿çš„å¹‚ç­‰æ€§ï¼Ÿ**

**A: æˆ‘ä»¬è®¾è®¡äº†å¤šå±‚ä¿éšœæœºåˆ¶ï¼š**

1. **å¹‚ç­‰æ€§ä¿è¯**
   - æ¯ä¸ªè¡¥å¿æ“ä½œéƒ½æœ‰å”¯ä¸€çš„æ“ä½œIDï¼ˆUUID + æ—¶é—´æˆ³ï¼‰
   - è¡¥å¿å‰å…ˆæŸ¥è¯¢æ“ä½œè®°å½•è¡¨ï¼Œé¿å…é‡å¤æ‰§è¡Œ
   - ä½¿ç”¨Redisåˆ†å¸ƒå¼é”ç¡®ä¿åŒä¸€æ“ä½œIDåªèƒ½æ‰§è¡Œä¸€æ¬¡

```java
@Transactional
public void executeCompensation(String operationId, CompensationContext context) {
    // 1. æ£€æŸ¥æ˜¯å¦å·²æ‰§è¡Œè¿‡
    if (compensationRecordService.isExecuted(operationId)) {
        log.info("è¡¥å¿æ“ä½œå·²æ‰§è¡Œï¼Œè·³è¿‡: {}", operationId);
        return;
    }
    
    // 2. è·å–åˆ†å¸ƒå¼é”
    RLock lock = redissonClient.getLock("compensation:" + operationId);
    if (!lock.tryLock(30, 10, TimeUnit.SECONDS)) {
        throw new RuntimeException("è·å–è¡¥å¿é”å¤±è´¥");
    }
    
    try {
        // 3. æ‰§è¡Œè¡¥å¿é€»è¾‘
        compensationExecutor.execute(context);
        
        // 4. è®°å½•æ‰§è¡ŒçŠ¶æ€
        compensationRecordService.recordSuccess(operationId, context);
    } finally {
        lock.unlock();
    }
}
```

2. **å¤±è´¥é‡è¯•æœºåˆ¶**
   - è¡¥å¿å¤±è´¥æ—¶ï¼Œæ¶ˆæ¯é‡æ–°å…¥é˜Ÿï¼Œå»¶è¿Ÿé‡è¯•
   - é‡è¯•æ¬¡æ•°é™åˆ¶ï¼ˆæœ€å¤š3æ¬¡ï¼‰ï¼Œé¿å…æ— é™é‡è¯•
   - é‡è¯•é—´éš”é€’å¢ï¼š1åˆ†é’Ÿã€5åˆ†é’Ÿã€15åˆ†é’Ÿ

3. **äººå·¥å¹²é¢„æœºåˆ¶**
   - è¡¥å¿å¤±è´¥è¶…è¿‡é‡è¯•æ¬¡æ•°åï¼Œè¿›å…¥äººå·¥å¤„ç†é˜Ÿåˆ—
   - æä¾›è¡¥å¿æ“ä½œçš„å¯è§†åŒ–ç•Œé¢ï¼Œæ”¯æŒæ‰‹åŠ¨é‡è¯•
   - è®°å½•è¯¦ç»†çš„å¤±è´¥æ—¥å¿—ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥

#### æ¶ˆæ¯é˜Ÿåˆ—å®•æœºå¤„ç†

**Q: æ¶ˆæ¯é˜Ÿåˆ—å®•æœºæ—¶å¦‚ä½•å¤„ç†ï¼Ÿ**

**A: æˆ‘ä»¬å®ç°äº†å¤šçº§é™çº§æ–¹æ¡ˆï¼š**

1. **æœ¬åœ°å­˜å‚¨é™çº§**
   - æ¶ˆæ¯é˜Ÿåˆ—ä¸å¯ç”¨æ—¶ï¼Œè¡¥å¿æ¶ˆæ¯å­˜å‚¨åˆ°æœ¬åœ°æ•°æ®åº“
   - ä½¿ç”¨å®šæ—¶ä»»åŠ¡æ‰«ææœ¬åœ°å­˜å‚¨ï¼Œæ‰§è¡Œè¡¥å¿æ“ä½œ
   - æ¶ˆæ¯é˜Ÿåˆ—æ¢å¤åï¼Œæ‰¹é‡åŒæ­¥æœ¬åœ°å­˜å‚¨çš„æ¶ˆæ¯

2. **åŒæ­¥è¡¥å¿é™çº§**
   - ç´§æ€¥æƒ…å†µä¸‹ï¼Œç›´æ¥åŒæ­¥æ‰§è¡Œè¡¥å¿é€»è¾‘
   - ç‰ºç‰²æ€§èƒ½ä¿è¯æ•°æ®ä¸€è‡´æ€§
   - æä¾›å¼€å…³æ§åˆ¶æ˜¯å¦å¯ç”¨åŒæ­¥è¡¥å¿

3. **ç›‘æ§å‘Šè­¦æœºåˆ¶**
   - å®æ—¶ç›‘æ§æ¶ˆæ¯é˜Ÿåˆ—çŠ¶æ€
   - é˜Ÿåˆ—å¼‚å¸¸æ—¶ç«‹å³å‘Šè­¦ï¼Œé€šçŸ¥è¿ç»´äººå‘˜
   - æä¾›é˜Ÿåˆ—å¥åº·æ£€æŸ¥æ¥å£

#### è¡¥å¿æ¶ˆæ¯é¡ºåºæ€§ä¿è¯

**Q: è¡¥å¿æ¶ˆæ¯çš„é¡ºåºæ€§å¦‚ä½•ä¿è¯ï¼Ÿ**

**A: æˆ‘ä»¬ä½¿ç”¨åˆ†åŒºé˜Ÿåˆ—å’Œé¡ºåºæ¶ˆè´¹ï¼š**

1. **åˆ†åŒºç­–ç•¥**
   - æŒ‰ä¸šåŠ¡IDï¼ˆå¦‚ä»»åŠ¡IDï¼‰è¿›è¡Œæ¶ˆæ¯åˆ†åŒº
   - åŒä¸€ä¸šåŠ¡IDçš„æ¶ˆæ¯å‘é€åˆ°åŒä¸€åˆ†åŒº
   - ä¿è¯åŒä¸€ä¸šåŠ¡çš„æ¶ˆæ¯é¡ºåºæ€§

2. **é¡ºåºæ¶ˆè´¹**
   - æ¯ä¸ªåˆ†åŒºåªåˆ†é…ä¸€ä¸ªæ¶ˆè´¹è€…
   - ä½¿ç”¨æ¶ˆæ¯çš„åºå·å­—æ®µä¿è¯é¡ºåº
   - æ¶ˆè´¹å¤±è´¥æ—¶ï¼Œæ¶ˆæ¯é‡æ–°å…¥é˜Ÿåˆ°åˆ†åŒºæœ«å°¾

### 2. ProxySQLæ•…éšœåˆ‡æ¢æ·±åº¦è§£æ

#### Pingé¢‘ç‡ä¼˜åŒ–

**Q: 200msçš„pingé¢‘ç‡æ˜¯å¦‚ä½•ç¡®å®šçš„ï¼Ÿä¸ºä»€ä¹ˆä¸æ˜¯100msæˆ–500msï¼Ÿ**

**A: æˆ‘ä»¬é€šè¿‡æ€§èƒ½æµ‹è¯•å’Œä¸šåŠ¡éœ€æ±‚ç¡®å®šï¼š**

1. **æ€§èƒ½æµ‹è¯•ç»“æœ**
   - 100msï¼šæ£€æµ‹å»¶è¿Ÿä½ï¼Œä½†ç½‘ç»œå¼€é”€å¤§ï¼ˆå¢åŠ 30%ï¼‰
   - 200msï¼šæ£€æµ‹å»¶è¿Ÿé€‚ä¸­ï¼Œç½‘ç»œå¼€é”€å¯æ¥å—ï¼ˆå¢åŠ 15%ï¼‰
   - 500msï¼šç½‘ç»œå¼€é”€å°ï¼Œä½†æ•…éšœæ£€æµ‹å»¶è¿Ÿé«˜ï¼ˆå¢åŠ 2-3ç§’ï¼‰

2. **ä¸šåŠ¡å®¹å¿åº¦åˆ†æ**
   - æˆ‘ä»¬çš„ä¸šåŠ¡å¯¹æ•°æ®å»¶è¿Ÿå®¹å¿åº¦æ˜¯5ç§’
   - 200ms Ã— 3æ¬¡å¤±è´¥ = 600msæ£€æµ‹æ—¶é—´
   - åŠ ä¸Šåˆ‡æ¢æ—¶é—´ï¼Œæ€»å»¶è¿Ÿæ§åˆ¶åœ¨2ç§’å†…

3. **åŠ¨æ€è°ƒæ•´æœºåˆ¶**
   - æ ¹æ®ç½‘ç»œè´¨é‡åŠ¨æ€è°ƒæ•´pingé¢‘ç‡
   - ç½‘ç»œç¨³å®šæ—¶ä½¿ç”¨500msï¼Œä¸ç¨³å®šæ—¶ä½¿ç”¨200ms
   - é€šè¿‡é…ç½®ä¸­å¿ƒå®æ—¶è°ƒæ•´

#### ç½‘ç»œæŠ–åŠ¨å¤„ç†

**Q: ç½‘ç»œæŠ–åŠ¨å¯¼è‡´çš„è¯¯åˆ¤å¦‚ä½•å¤„ç†ï¼Ÿ**

**A: æˆ‘ä»¬å®ç°äº†æ™ºèƒ½æ•…éšœæ£€æµ‹ç®—æ³•ï¼š**

1. **å¤šç»´åº¦æ£€æµ‹**
   - è¿æ¥æ£€æµ‹ï¼šTCPè¿æ¥çŠ¶æ€
   - å“åº”æ—¶é—´æ£€æµ‹ï¼špingå“åº”æ—¶é—´
   - ä¸šåŠ¡æ£€æµ‹ï¼šç®€å•SQLæŸ¥è¯¢å“åº”

2. **æ»‘åŠ¨çª—å£ç®—æ³•**
   - ä½¿ç”¨10æ¬¡æ£€æµ‹çš„æ»‘åŠ¨çª—å£
   - å¤±è´¥ç‡è¶…è¿‡70%æ‰åˆ¤å®šä¸ºæ•…éšœ
   - é¿å…å¶å‘æ€§ç½‘ç»œæŠ–åŠ¨è¯¯åˆ¤

3. **æ•…éšœç¡®è®¤æœºåˆ¶**
   - åˆæ­¥æ£€æµ‹åˆ°æ•…éšœåï¼Œè¿›è¡ŒäºŒæ¬¡ç¡®è®¤
   - è¿ç»­3æ¬¡ç¡®è®¤å¤±è´¥æ‰æ‰§è¡Œåˆ‡æ¢
   - æä¾›æ‰‹åŠ¨ç¡®è®¤å¼€å…³

#### ä¸»ä»åˆ‡æ¢æ•°æ®ä¸€è‡´æ€§

**Q: ä¸»ä»åˆ‡æ¢è¿‡ç¨‹ä¸­çš„æ•°æ®ä¸€è‡´æ€§å¦‚ä½•ä¿è¯ï¼Ÿ**

**A: æˆ‘ä»¬ä½¿ç”¨å¤šé˜¶æ®µåˆ‡æ¢ç­–ç•¥ï¼š**

1. **åˆ‡æ¢å‰å‡†å¤‡**
   - æ£€æŸ¥ä»åº“å¤åˆ¶å»¶è¿Ÿï¼Œç¡®ä¿å»¶è¿Ÿå°äº1ç§’
   - æš‚åœå†™æ“ä½œï¼Œç­‰å¾…æ‰€æœ‰äº‹åŠ¡å®Œæˆ
   - è®°å½•å½“å‰binlogä½ç½®

2. **åˆ‡æ¢æ‰§è¡Œ**
   - å°†æ–°ä¸»åº“æ ‡è®°ä¸ºONLINE
   - æ›´æ–°è·¯ç”±è§„åˆ™ï¼Œå†™è¯·æ±‚è·¯ç”±åˆ°æ–°ä¸»åº“
   - ç­‰å¾…æ‰€æœ‰è¿æ¥åˆ‡æ¢åˆ°æ–°ä¸»åº“

3. **åˆ‡æ¢åéªŒè¯**
   - éªŒè¯æ–°ä¸»åº“æ•°æ®å®Œæ•´æ€§
   - æ£€æŸ¥å¤åˆ¶çŠ¶æ€ï¼Œç¡®ä¿ä»åº“åŒæ­¥æ­£å¸¸
   - æ¢å¤å†™æ“ä½œ

### 3. RedisåŒå†™ä¸€è‡´æ€§æ·±åº¦è§£æ

#### ç¼“å­˜ç©¿é€è§£å†³æ–¹æ¡ˆ

**Q: ç¼“å­˜ç©¿é€é—®é¢˜å¦‚ä½•è§£å†³ï¼Ÿ**

**A: æˆ‘ä»¬å®ç°äº†å¤šå±‚é˜²æŠ¤ï¼š**

1. **å¸ƒéš†è¿‡æ»¤å™¨**
   - åœ¨Rediså‰å¢åŠ å¸ƒéš†è¿‡æ»¤å™¨å±‚
   - è¿‡æ»¤æ‰ä¸å­˜åœ¨çš„keyï¼Œé¿å…æ— æ•ˆæŸ¥è¯¢
   - è¯¯åˆ¤ç‡æ§åˆ¶åœ¨0.1%ä»¥å†…

2. **ç©ºå€¼ç¼“å­˜**
   - æŸ¥è¯¢ç»“æœä¸ºç©ºçš„keyä¹Ÿç¼“å­˜åˆ°Redis
   - è®¾ç½®è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ï¼ˆå¦‚5åˆ†é’Ÿï¼‰
   - é¿å…é‡å¤æŸ¥è¯¢æ•°æ®åº“

3. **å‚æ•°æ ¡éªŒ**
   - åœ¨åº”ç”¨å±‚è¿›è¡Œå‚æ•°æ ¼å¼æ ¡éªŒ
   - è¿‡æ»¤æ‰æ˜æ˜¾æ— æ•ˆçš„æŸ¥è¯¢è¯·æ±‚
   - å‡å°‘æ— æ•ˆè¯·æ±‚åˆ°è¾¾ç¼“å­˜å±‚

#### ç¼“å­˜é›ªå´©è§£å†³æ–¹æ¡ˆ

**Q: çƒ­ç‚¹æ•°æ®å¤±æ•ˆæ—¶å¦‚ä½•é¿å…ç¼“å­˜é›ªå´©ï¼Ÿ**

**A: æˆ‘ä»¬ä½¿ç”¨å¤šç§ç­–ç•¥ç»„åˆï¼š**

1. **è¿‡æœŸæ—¶é—´éšæœºåŒ–**
   - åŸºç¡€è¿‡æœŸæ—¶é—´ + éšæœºåç§»é‡ï¼ˆÂ±300ç§’ï¼‰
   - é¿å…å¤§é‡keyåŒæ—¶å¤±æ•ˆ
   - åˆ†æ•£ç¼“å­˜é‡å»ºå‹åŠ›

2. **çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸ**
   - è¯†åˆ«çƒ­ç‚¹æ•°æ®ï¼ˆè®¿é—®é¢‘ç‡ > 1000æ¬¡/åˆ†é’Ÿï¼‰
   - è®¾ç½®æ°¸ä¸è¿‡æœŸï¼Œé€šè¿‡åå°ä»»åŠ¡æ›´æ–°
   - é¿å…çƒ­ç‚¹æ•°æ®å¤±æ•ˆå¯¼è‡´çš„é›ªå´©

3. **ç†”æ–­æœºåˆ¶**
   - å½“ç¼“å­˜å‘½ä¸­ç‡ä½äº50%æ—¶ï¼Œå¯ç”¨ç†”æ–­
   - ç›´æ¥è¿”å›é™çº§æ•°æ®ï¼Œé¿å…æ•°æ®åº“å‹åŠ›
   - æä¾›å¼€å…³æ§åˆ¶ç†”æ–­ç­–ç•¥

#### å»¶è¿ŸåŒåˆ å®ç°ç»†èŠ‚

**Q: å»¶è¿ŸåŒåˆ çš„å…·ä½“å®ç°ç»†èŠ‚æ˜¯ä»€ä¹ˆï¼Ÿ**

**A: æˆ‘ä»¬ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å®ç°å»¶è¿ŸåŒåˆ ï¼š**

```java
@Service
public class CacheService {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    @Autowired
    private RabbitTemplate rabbitTemplate;
    
    public void updateData(String key, Object value) {
        // 1. æ›´æ–°æ•°æ®åº“
        databaseService.update(key, value);
        
        // 2. åˆ é™¤ç¼“å­˜
        redisTemplate.delete(key);
        
        // 3. å‘é€å»¶è¿Ÿåˆ é™¤æ¶ˆæ¯
        sendDelayDeleteMessage(key, 5000); // 5ç§’åå†æ¬¡åˆ é™¤
    }
    
    private void sendDelayDeleteMessage(String key, long delay) {
        // ä½¿ç”¨RabbitMQçš„å»¶è¿Ÿé˜Ÿåˆ—æ’ä»¶
        Message message = MessageBuilder
            .withBody(key.getBytes())
            .setHeader("x-delay", delay)
            .build();
        
        rabbitTemplate.send("cache.delay.exchange", "cache.delay.queue", message);
    }
    
    @RabbitListener(queues = "cache.delay.queue")
    public void handleDelayDelete(String key) {
        // å»¶è¿Ÿåˆ é™¤ç¼“å­˜ï¼Œé˜²æ­¢ç¼“å­˜ä¸ä¸€è‡´
        redisTemplate.delete(key);
    }
}
```

### 4. çº¿ç¨‹æ± å¼‚æ­¥åˆ†ç‰‡æ·±åº¦è§£æ

#### çº¿ç¨‹æ± å‚æ•°é…ç½®

**Q: çº¿ç¨‹æ± çš„æ ¸å¿ƒçº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°å¦‚ä½•ç¡®å®šï¼Ÿ**

**A: æˆ‘ä»¬é€šè¿‡æ€§èƒ½æµ‹è¯•å’Œèµ„æºåˆ†æç¡®å®šï¼š**

1. **èµ„æºåˆ†æ**
   - CPUæ ¸å¿ƒæ•°ï¼š8æ ¸
   - å†…å­˜å®¹é‡ï¼š16GB
   - æ•°æ®åº“è¿æ¥æ± ï¼š20ä¸ªè¿æ¥

2. **æ€§èƒ½æµ‹è¯•ç»“æœ**
   - æ ¸å¿ƒçº¿ç¨‹æ•°ï¼š8ï¼ˆç­‰äºCPUæ ¸å¿ƒæ•°ï¼‰
   - æœ€å¤§çº¿ç¨‹æ•°ï¼š16ï¼ˆCPUæ ¸å¿ƒæ•°çš„2å€ï¼‰
   - é˜Ÿåˆ—å¤§å°ï¼š1000ï¼ˆé¿å…OOMï¼‰

3. **åŠ¨æ€è°ƒæ•´æœºåˆ¶**
   - ç›‘æ§çº¿ç¨‹æ± æ´»è·ƒçº¿ç¨‹æ•°
   - å½“æ´»è·ƒçº¿ç¨‹æ•°æŒç»­è¶…è¿‡æ ¸å¿ƒçº¿ç¨‹æ•°æ—¶ï¼Œå¢åŠ æœ€å¤§çº¿ç¨‹æ•°
   - é€šè¿‡é…ç½®ä¸­å¿ƒå®æ—¶è°ƒæ•´

#### åˆ†ç‰‡å¤§å°ç¡®å®š

**Q: åˆ†ç‰‡å¤§å°1ä¸‡è¡Œæ˜¯å¦‚ä½•ç¡®å®šçš„ï¼Ÿ**

**A: æˆ‘ä»¬é€šè¿‡å¤šç»´åº¦æµ‹è¯•ç¡®å®šæœ€ä¼˜åˆ†ç‰‡å¤§å°ï¼š**

1. **å†…å­˜ä½¿ç”¨æµ‹è¯•**
   - 5000è¡Œï¼šå†…å­˜ä½¿ç”¨2GBï¼Œå¤„ç†æ—¶é—´30ç§’
   - 10000è¡Œï¼šå†…å­˜ä½¿ç”¨4GBï¼Œå¤„ç†æ—¶é—´55ç§’
   - 20000è¡Œï¼šå†…å­˜ä½¿ç”¨8GBï¼Œå¤„ç†æ—¶é—´120ç§’

2. **æ•°æ®åº“æ€§èƒ½æµ‹è¯•**
   - æ‰¹é‡æ’å…¥10000è¡Œï¼šå“åº”æ—¶é—´2ç§’
   - æ‰¹é‡æ’å…¥20000è¡Œï¼šå“åº”æ—¶é—´5ç§’
   - æ‰¹é‡æ’å…¥50000è¡Œï¼šå“åº”æ—¶é—´15ç§’

3. **ç”¨æˆ·ä½“éªŒè€ƒè™‘**
   - 10000è¡Œåˆ†ç‰‡ï¼šè¿›åº¦æ›´æ–°é¢‘ç‡é€‚ä¸­ï¼ˆæ¯10ç§’æ›´æ–°ä¸€æ¬¡ï¼‰
   - ç”¨æˆ·ç­‰å¾…æ—¶é—´å¯æ¥å—ï¼ˆå•åˆ†ç‰‡å¤„ç†æ—¶é—´çº¦1åˆ†é’Ÿï¼‰
   - é”™è¯¯å®šä½ç²¾ç¡®ï¼ˆé—®é¢˜æ•°æ®èŒƒå›´å¯æ§ï¼‰

### 5. ç­–ç•¥æ¨¡å¼Springå®ç°æ·±åº¦è§£æ

#### è‡ªåŠ¨å‘ç°å’Œæ³¨å†Œç­–ç•¥

**Q: å¦‚ä½•é€šè¿‡Springè‡ªåŠ¨å‘ç°å’Œæ³¨å†Œç­–ç•¥ï¼Ÿ**

**A: æˆ‘ä»¬ä½¿ç”¨Springçš„è‡ªåŠ¨è£…é…æœºåˆ¶ï¼š**

```java
@Component
public class MessageSenderFactory {
    
    @Autowired
    private Map<String, MessageSender> senderMap;
    
    public MessageSender getSender(String type) {
        MessageSender sender = senderMap.get(type + "Sender");
        if (sender == null) {
            throw new IllegalArgumentException("ä¸æ”¯æŒçš„æ¶ˆæ¯ç±»å‹: " + type);
        }
        return sender;
    }
}

@Component("emailSender")
public class EmailSender implements MessageSender {
    // é‚®ä»¶å‘é€å®ç°
}

@Component("smsSender") 
public class SmsSender implements MessageSender {
    // çŸ­ä¿¡å‘é€å®ç°
}
```

#### ç­–ç•¥åŠ¨æ€åˆ‡æ¢

**Q: ç­–ç•¥çš„åŠ¨æ€åˆ‡æ¢å¦‚ä½•å®ç°ï¼Ÿ**

**A: æˆ‘ä»¬ä½¿ç”¨é…ç½®ä¸­å¿ƒå®ç°åŠ¨æ€åˆ‡æ¢ï¼š**

```java
@Component
public class DynamicMessageSenderFactory {
    
    @Autowired
    private NacosConfigService configService;
    
    @Autowired
    private Map<String, MessageSender> senderMap;
    
    public MessageSender getSender(String type) {
        // ä»é…ç½®ä¸­å¿ƒè·å–ç­–ç•¥é…ç½®
        String config = configService.getConfig("message.sender." + type, "DEFAULT", 5000);
        
        // æ ¹æ®é…ç½®é€‰æ‹©ç­–ç•¥
        String strategy = JSON.parseObject(config).getString("strategy");
        MessageSender sender = senderMap.get(strategy);
        
        if (sender == null) {
            // é™çº§åˆ°é»˜è®¤ç­–ç•¥
            sender = senderMap.get("defaultSender");
        }
        
        return sender;
    }
}
```

#### ç­–ç•¥é…ç½®çƒ­æ›´æ–°

**Q: ç­–ç•¥çš„é…ç½®çƒ­æ›´æ–°å¦‚ä½•åšï¼Ÿ**

**A: æˆ‘ä»¬ä½¿ç”¨Nacosé…ç½®ä¸­å¿ƒå®ç°çƒ­æ›´æ–°ï¼š**

```java
@Component
public class MessageSenderConfigListener {
    
    @NacosConfigListener(dataId = "message.sender.config", groupId = "DEFAULT_GROUP")
    public void onMessage(String newContent) {
        // è§£ææ–°é…ç½®
        MessageSenderConfig config = JSON.parseObject(newContent, MessageSenderConfig.class);
        
        // æ›´æ–°ç­–ç•¥é…ç½®
        updateStrategyConfig(config);
        
        // è®°å½•é…ç½®å˜æ›´æ—¥å¿—
        log.info("æ¶ˆæ¯å‘é€ç­–ç•¥é…ç½®å·²æ›´æ–°: {}", config);
    }
    
    private void updateStrategyConfig(MessageSenderConfig config) {
        // æ›´æ–°ç­–ç•¥æ˜ å°„å…³ç³»
        // æ›´æ–°é‡è¯•ç­–ç•¥
        // æ›´æ–°é™æµé…ç½®
    }
}
```

### 6. æ€§èƒ½æŒ‡æ ‡å’Œç›‘æ§æ•°æ®

#### ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡

**äº¬ä¸œé¡¹ç›®æ€§èƒ½æ•°æ®ï¼š**
- ç³»ç»Ÿå“åº”æ—¶é—´ï¼šå¹³å‡200msï¼Œ95%è¯·æ±‚ < 500ms
- å¹¶å‘å¤„ç†èƒ½åŠ›ï¼šæ”¯æŒ1000å¹¶å‘ç”¨æˆ·
- ä»»åŠ¡è°ƒåº¦å»¶è¿Ÿï¼š< 100ms
- ç³»ç»Ÿå¯ç”¨æ€§ï¼š99.9%

**æ‹›è¡Œé¡¹ç›®æ€§èƒ½æ•°æ®ï¼š**
- æ•°æ®å¤„ç†é€Ÿåº¦ï¼š10ä¸‡è¡Œæ•°æ®å¤„ç†æ—¶é—´ < 10åˆ†é’Ÿ
- å†…å­˜ä½¿ç”¨ï¼šå³°å€¼å†…å­˜ä½¿ç”¨ < 8GB
- å¹¶å‘å¤„ç†ï¼šæ”¯æŒ20ä¸ªå¹¶å‘ä»»åŠ¡
- ç¼“å­˜å‘½ä¸­ç‡ï¼š> 95%

#### ç›‘æ§å’Œå‘Šè­¦

**ç›‘æ§æŒ‡æ ‡ï¼š**
- ç³»ç»Ÿèµ„æºï¼šCPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œ
- åº”ç”¨æ€§èƒ½ï¼šå“åº”æ—¶é—´ã€ååé‡ã€é”™è¯¯ç‡
- ä¸šåŠ¡æŒ‡æ ‡ï¼šä»»åŠ¡æ‰§è¡ŒæˆåŠŸç‡ã€å¤„ç†æ—¶é—´ã€æ•°æ®è´¨é‡

**å‘Šè­¦ç­–ç•¥ï¼š**
- CPUä½¿ç”¨ç‡ > 80%ï¼šè­¦å‘Š
- å†…å­˜ä½¿ç”¨ç‡ > 85%ï¼šè­¦å‘Š
- å“åº”æ—¶é—´ > 2ç§’ï¼šè­¦å‘Š
- é”™è¯¯ç‡ > 1%ï¼šä¸¥é‡å‘Šè­¦

### 7. è¾¹ç•Œæƒ…å†µå’Œå¼‚å¸¸å¤„ç†

#### æç«¯åœºæ™¯å¤„ç†

**ç½‘ç»œåˆ†åŒºåœºæ™¯ï¼š**
- ä½¿ç”¨å¿ƒè·³æ£€æµ‹è¯†åˆ«ç½‘ç»œåˆ†åŒº
- å®ç°åˆ†åŒºå®¹å¿çš„åˆ†å¸ƒå¼ç®—æ³•
- æä¾›æ‰‹åŠ¨å¹²é¢„æ¥å£

**æœåŠ¡é›ªå´©åœºæ™¯ï¼š**
- å®ç°ç†”æ–­å™¨æ¨¡å¼
- æä¾›é™çº§æœåŠ¡
- ä½¿ç”¨é™æµä¿æŠ¤

**æ•°æ®ä¸ä¸€è‡´åœºæ™¯ï¼š**
- å®šæœŸæ•°æ®ä¸€è‡´æ€§æ£€æŸ¥
- æä¾›æ•°æ®ä¿®å¤å·¥å…·
- å®ç°æ•°æ®ç‰ˆæœ¬æ§åˆ¶

#### é™çº§å’Œåº”æ€¥é¢„æ¡ˆ

**ç³»ç»Ÿé™çº§ç­–ç•¥ï¼š**
- åŠŸèƒ½é™çº§ï¼šéæ ¸å¿ƒåŠŸèƒ½å¯å…³é—­
- æ€§èƒ½é™çº§ï¼šé™ä½å¹¶å‘å¤„ç†èƒ½åŠ›
- æœåŠ¡é™çº§ï¼šä½¿ç”¨ç¼“å­˜æ•°æ®æ›¿ä»£å®æ—¶æ•°æ®

**åº”æ€¥å¤„ç†æµç¨‹ï¼š**
- é—®é¢˜è¯†åˆ«ï¼šç›‘æ§å‘Šè­¦ + æ—¥å¿—åˆ†æ
- å½±å“è¯„ä¼°ï¼šä¸šåŠ¡å½±å“èŒƒå›´å’Œæ—¶é—´
- åº”æ€¥å¤„ç†ï¼šå¯ç”¨é™çº§ç­–ç•¥
- é—®é¢˜ä¿®å¤ï¼šæ ¹æœ¬åŸå› åˆ†æå’Œä¿®å¤
- æ¢å¤éªŒè¯ï¼šåŠŸèƒ½éªŒè¯å’Œæ€§èƒ½æµ‹è¯•

é€šè¿‡ä»¥ä¸Šè¯¦ç»†çš„è§£å†³æ–¹æ¡ˆï¼Œä½ å¯ä»¥æ›´å¥½åœ°åº”å¯¹é¢è¯•å®˜çš„æ·±åº¦è¿½é—®ï¼Œå±•ç¤ºä½ çš„æŠ€æœ¯æ·±åº¦å’Œè§£å†³é—®é¢˜çš„èƒ½åŠ›ã€‚
